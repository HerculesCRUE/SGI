<sgi-fragment title="{{'menu.prc.moduladores-rangos' | translate}}">

  <form [formGroup]="formGroup" fxLayout="column">
    <!-- Modulador numero autores por area -->
    <section class="table-section" fxLayout="column">
      <h2 id="moduladores-autores-areas">{{'prc.modulador.tipo.NUMERO_AUTORES' | translate}}
      </h2>

      <div class="mat-elevation-z4">
        <table aria-describedby="moduladores-autores-areas" mat-table [dataSource]="moduladoresAutoresAreaDataSource"
          matSort matSortActive="area" matSortDirection="asc" matSortDisableClear #sortModuladoresAutoresArea="matSort">

          <!-- Area Column -->
          <ng-container matColumnDef="area">
            <th mat-header-cell *matHeaderCellDef>
              {{'prc.moduladores-rango.area' | translate}}
            </th>
            <td mat-cell *matCellDef="let modulador">
              {{ modulador.area.nombre }}
            </td>
          </ng-container>

          <!-- Valor 1 Column -->
          <ng-container matColumnDef="valor1">
            <th mat-header-cell *matHeaderCellDef>
              {{'prc.moduladores-rango.valor1' | translate}}
            </th>
            <td mat-cell *matCellDef="let modulador" [formGroup]="modulador.valores">
              <mat-form-field>
                <input matInput formControlName="valor1" type="number" step="0.1" min="0" required>
              </mat-form-field>
            </td>
          </ng-container>

          <!-- Valor 2 Column -->
          <ng-container matColumnDef="valor2">
            <th mat-header-cell *matHeaderCellDef>
              {{'prc.moduladores-rango.valor2' | translate}}
            </th>
            <td mat-cell *matCellDef="let modulador" [formGroup]="modulador.valores">
              <mat-form-field>
                <input matInput formControlName="valor2" type="number" step="0.1" min="0" required>
              </mat-form-field>
            </td>
          </ng-container>

          <!-- Valor 3 Column -->
          <ng-container matColumnDef="valor3">
            <th mat-header-cell *matHeaderCellDef>
              {{'prc.moduladores-rango.valor3' | translate}}
            </th>
            <td mat-cell *matCellDef="let modulador" [formGroup]="modulador.valores">
              <mat-form-field>
                <input matInput formControlName="valor3" type="number" step="0.1" min="0" required>
              </mat-form-field>
            </td>
          </ng-container>

          <!-- Valor 4 Column -->
          <ng-container matColumnDef="valor4">
            <th mat-header-cell *matHeaderCellDef>
              {{'prc.moduladores-rango.valor4' | translate}}
            </th>
            <td mat-cell *matCellDef="let modulador" [formGroup]="modulador.valores">
              <mat-form-field>
                <input matInput formControlName="valor4" type="number" step="0.1" min="0" required>
              </mat-form-field>
            </td>
          </ng-container>

          <!-- Valor 5 Column -->
          <ng-container matColumnDef="valor5">
            <th mat-header-cell *matHeaderCellDef>
              {{'prc.moduladores-rango.valor5' | translate}}
            </th>
            <td mat-cell *matCellDef="let modulador" [formGroup]="modulador.valores">
              <mat-form-field>
                <input matInput formControlName="valor5" type="number" step="0.1" min="0" required>
              </mat-form-field>
            </td>
          </ng-container>

          <tr mat-header-row *matHeaderRowDef="displayedColumnsModuladorNumeroAutores"></tr>
          <tr mat-row *matRowDef="let row; columns: displayedColumnsModuladorNumeroAutores;"></tr>
        </table>
      </div>
    </section>

    <!-- Modulador numero autores por area -->
    <section class="table-section" fxLayout="column">
      <h2 id="moduladores-autores-areas">{{'prc.modulador.tipo.AREAS' | translate}}
      </h2>

      <div class="mat-elevation-z4">
        <table aria-describedby="moduladores-autores-areas" mat-table [dataSource]="moduladoresAreasDataSource" matSort
          matSortActive="area" matSortDirection="asc" matSortDisableClear #sortModuladoresAreas="matSort">

          <!-- Area Column -->
          <ng-container matColumnDef="area">
            <th mat-header-cell *matHeaderCellDef>
              {{'prc.moduladores-rango.area' | translate}}
            </th>
            <td mat-cell *matCellDef="let modulador">
              {{ modulador.area.nombre }}
            </td>
          </ng-container>

          <!-- Puntos Column -->
          <ng-container matColumnDef="puntos">
            <th mat-header-cell *matHeaderCellDef>
              {{'prc.moduladores-rango.puntos' | translate}}
            </th>
            <td mat-cell *matCellDef="let modulador" [formGroup]="modulador.valores">
              <mat-form-field>
                <input matInput formControlName="valor1" type="number" step="0.1" min="0" required>
              </mat-form-field>
            </td>
          </ng-container>

          <tr mat-header-row *matHeaderRowDef="displayedColumnsModuladorAreas"></tr>
          <tr mat-row *matRowDef="let row; columns: displayedColumnsModuladorAreas;"></tr>
        </table>
      </div>
    </section>

    <!-- Cuantia costes indirectos -->
    <section class="table-section" fxLayout="column" *ngIf="formPart.hasCostesIndirectosTipoRango$ | async">
      <h2 id="cuantia-costes-indirectos">{{'prc.moduladores-rangos.cuantia-costes-indirectos' | translate}}
      </h2>

      <div class="mat-elevation-z4">
        <table aria-describedby="cuantia-costes-indirectos" mat-table
          [dataSource]="rangosCuantiaCostesIndirectosDataSource" matSort matSortActive="rango" matSortDirection="asc"
          matSortDisableClear #sortRangosCuantiaCostesIndirectos="matSort">

          <!-- Rango Column -->
          <ng-container matColumnDef="rango">
            <th mat-header-cell *matHeaderCellDef>
              {{'prc.moduladores-rango.rango' | translate}}
            </th>
            <td mat-cell *matCellDef="let rango">
              {{ rango.value | rango }}
            </td>
          </ng-container>

          <!-- Tipo Column -->
          <ng-container matColumnDef="tipo">
            <th mat-header-cell *matHeaderCellDef>
              {{'prc.moduladores-rango.tipo' | translate}}
            </th>
            <td mat-cell *matCellDef="let rango">
              {{ TIPO_TEMPORALIDAD_MAP.get(rango.value.tipoTemporalidad) | translate }}
            </td>
          </ng-container>

          <!-- Puntos Column -->
          <ng-container matColumnDef="puntos">
            <th mat-header-cell *matHeaderCellDef>
              {{'prc.moduladores-rango.puntos' | translate}}
            </th>
            <td mat-cell *matCellDef="let rango">
              {{ rango.value.puntos }}
            </td>
          </ng-container>

          <!-- Acciones Column -->
          <ng-container matColumnDef="acciones">
            <th mat-header-cell *matHeaderCellDef>
              {{'label.actions' | translate}}
            </th>
            <td mat-cell *matCellDef="let rango">
              <ng-container *sgiHasAnyAuthority="['PRC-CON-C', 'PRC-CON-E']">
                <button *ngIf="formPart.isEditPerm" mat-icon-button color="primary"
                  matTooltip="{{'btn.edit' | translate}}"
                  (click)="openModalRango(TipoRango.CUANTIA_COSTES_INDIRECTOS, rango)">
                  <mat-icon>border_color</mat-icon>
                </button>
              </ng-container>
              <ng-container *sgiHasAnyAuthority="['PRC-CON-C', 'PRC-CON-E']">
                <button *ngIf="formPart.isEditPerm" mat-icon-button color="warn"
                  matTooltip="{{'btn.delete' | translate}}"
                  (click)="deleteRango(TipoRango.CUANTIA_COSTES_INDIRECTOS, rango)">
                  <mat-icon>highlight_off</mat-icon>
                </button>
              </ng-container>
            </td>
          </ng-container>

          <tr mat-header-row *matHeaderRowDef="displayedColumnsRangos"></tr>
          <tr mat-row *matRowDef="let row; columns: displayedColumnsRangos;"></tr>
        </table>
      </div>


      <div class="separation-button" *sgiHasAnyAuthority="['PRC-CON-C', 'PRC-CON-E']">
        <button color="three" mat-button mat-raised-button (click)="openModalRango(TipoRango.CUANTIA_COSTES_INDIRECTOS)"
          [disabled]="!formPart.isEditPerm || hasRangosFinal(TipoRango.CUANTIA_COSTES_INDIRECTOS)">
          <mat-icon color="accent">add_circle</mat-icon>
          {{ 'btn.add.entity' | translate:msgParamRangosCostesIndirectosEntity }}
        </button>
      </div>
    </section>

    <!-- Cuantia contratos -->
    <section class="table-section" fxLayout="column">
      <h2 id="cuantia-contratos">{{'prc.moduladores-rangos.cuantia-contratos' | translate}}</h2>

      <div class="mat-elevation-z4">
        <table aria-describedby="contratos" mat-table [dataSource]="rangosCuantiaContratosDataSource" matSort
          matSortActive="rango" matSortDirection="asc" matSortDisableClear #sortRangosCuantiaContratos="matSort">

          <!-- Rango Column -->
          <ng-container matColumnDef="rango">
            <th mat-header-cell *matHeaderCellDef>
              {{'prc.moduladores-rango.rango' | translate}}
            </th>
            <td mat-cell *matCellDef="let rango">
              {{ rango.value | rango }}
            </td>
          </ng-container>

          <!-- Tipo Column -->
          <ng-container matColumnDef="tipo">
            <th mat-header-cell *matHeaderCellDef>
              {{'prc.moduladores-rango.tipo' | translate}}
            </th>
            <td mat-cell *matCellDef="let rango">
              {{ TIPO_TEMPORALIDAD_MAP.get(rango.value.tipoTemporalidad) | translate }}
            </td>
          </ng-container>

          <!-- Puntos Column -->
          <ng-container matColumnDef="puntos">
            <th mat-header-cell *matHeaderCellDef>
              {{'prc.moduladores-rango.puntos' | translate}}
            </th>
            <td mat-cell *matCellDef="let rango">
              {{ rango.value.puntos }}
            </td>
          </ng-container>

          <!-- Acciones Column -->
          <ng-container matColumnDef="acciones">
            <th mat-header-cell *matHeaderCellDef>
              {{'label.actions' | translate}}
            </th>
            <td mat-cell *matCellDef="let rango">
              <ng-container *sgiHasAnyAuthority="['PRC-CON-C', 'PRC-CON-E']">
                <button *ngIf="formPart.isEditPerm" mat-icon-button color="primary"
                  matTooltip="{{'btn.edit' | translate}}" (click)="openModalRango(TipoRango.CUANTIA_CONTRATOS, rango)">
                  <mat-icon>border_color</mat-icon>
                </button>
              </ng-container>
              <ng-container *sgiHasAnyAuthority="['PRC-CON-C', 'PRC-CON-E']">
                <button *ngIf="formPart.isEditPerm" mat-icon-button color="warn"
                  matTooltip="{{'btn.delete' | translate}}" (click)="deleteRango(TipoRango.CUANTIA_CONTRATOS, rango)">
                  <mat-icon>highlight_off</mat-icon>
                </button>
              </ng-container>
            </td>
          </ng-container>

          <tr mat-header-row *matHeaderRowDef="displayedColumnsRangos"></tr>
          <tr mat-row *matRowDef="let row; columns: displayedColumnsRangos;"></tr>
        </table>
      </div>


      <div class="separation-button" *sgiHasAnyAuthority="['PRC-CON-C', 'PRC-CON-E']">
        <button color="three" mat-button mat-raised-button (click)="openModalRango(TipoRango.CUANTIA_CONTRATOS)"
          [disabled]="!formPart.isEditPerm || hasRangosFinal(TipoRango.CUANTIA_CONTRATOS)">
          <mat-icon color="accent">add_circle</mat-icon>
          {{ 'btn.add.entity' | translate:msgParamRangosContratosEntity }}
        </button>
      </div>
    </section>

    <!-- Ingresos licencias explotacion -->
    <section class="table-section" fxLayout="column">
      <h2 id="ingresos-licencias">{{'prc.moduladores-rangos.ingresos-licencias' | translate}}
      </h2>

      <div class="mat-elevation-z4">
        <table aria-describedby="ingresos-licencias" mat-table [dataSource]="rangosIngresosLicenciasDataSource" matSort
          matSortActive="rango" matSortDirection="asc" matSortDisableClear #sortRangosIngresosLicencias="matSort">

          <!-- Rango Column -->
          <ng-container matColumnDef="rango">
            <th mat-header-cell *matHeaderCellDef>
              {{'prc.moduladores-rango.rango' | translate}}
            </th>
            <td mat-cell *matCellDef="let rango">
              {{ rango.value | rango }}
            </td>
          </ng-container>

          <!-- Tipo Column -->
          <ng-container matColumnDef="tipo">
            <th mat-header-cell *matHeaderCellDef>
              {{'prc.moduladores-rango.tipo' | translate}}
            </th>
            <td mat-cell *matCellDef="let rango">
              {{ TIPO_TEMPORALIDAD_MAP.get(rango.value.tipoTemporalidad) | translate }}
            </td>
          </ng-container>

          <!-- Puntos Column -->
          <ng-container matColumnDef="puntos">
            <th mat-header-cell *matHeaderCellDef>
              {{'prc.moduladores-rango.puntos' | translate}}
            </th>
            <td mat-cell *matCellDef="let rango">
              {{ rango.value.puntos }}
            </td>
          </ng-container>

          <!-- Acciones Column -->
          <ng-container matColumnDef="acciones">
            <th mat-header-cell *matHeaderCellDef>
              {{'label.actions' | translate}}
            </th>
            <td mat-cell *matCellDef="let rango">
              <ng-container *sgiHasAnyAuthority="['PRC-CON-C', 'PRC-CON-E']">
                <button *ngIf="formPart.isEditPerm" mat-icon-button color="primary"
                  matTooltip="{{'btn.edit' | translate}}" (click)="openModalRango(TipoRango.LICENCIA, rango)">
                  <mat-icon>border_color</mat-icon>
                </button>
              </ng-container>
              <ng-container *sgiHasAnyAuthority="['PRC-CON-C', 'PRC-CON-E']">
                <button *ngIf="formPart.isEditPerm" mat-icon-button color="warn"
                  matTooltip="{{'btn.delete' | translate}}" (click)="deleteRango(TipoRango.LICENCIA, rango)">
                  <mat-icon>highlight_off</mat-icon>
                </button>
              </ng-container>
            </td>
          </ng-container>

          <tr mat-header-row *matHeaderRowDef="displayedColumnsRangos"></tr>
          <tr mat-row *matRowDef="let row; columns: displayedColumnsRangos;"></tr>
        </table>
      </div>


      <div class="separation-button" *sgiHasAnyAuthority="['PRC-CON-C', 'PRC-CON-E']">
        <button color="three" mat-button mat-raised-button (click)="openModalRango(TipoRango.LICENCIA)"
          [disabled]="!formPart.isEditPerm || hasRangosFinal(TipoRango.LICENCIA)">
          <mat-icon color="accent">add_circle</mat-icon>
          {{ 'btn.add.entity' | translate:msgParamRangosLicenciasEntity }}
        </button>
      </div>
    </section>
  </form>
</sgi-fragment>