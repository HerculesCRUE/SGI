<!-- Autorizacion Listado-->
<sgi-menu-content>
  <div class="mat-elevation-z4">
    <form [formGroup]="formGroup" class="busqueda" [fxLayout.xs]="fxLayoutProperties.xs"
      [fxLayout]="fxLayoutProperties.layout" fxLayoutGap="fxLayoutProperties.gap">

      <div [fxLayout.xs]="fxLayoutProperties.xs" [fxLayout]="fxLayoutProperties.layout"
        [fxLayoutGap]="fxLayoutProperties.gap" ngClass.gt-xs="ml-10">

        <!-- Fecha desde-->
        <div class="col">
          <mat-form-field>
            <mat-label>{{'csp.autorizacion.fecha-solicitud-desde' | translate}}</mat-label>
            <input matInput formControlName="fechaSolicitudInicio" [matDatepicker]="pickerFechaSolicitudInicio"
              [placeholder]="'csp.autorizacion.fecha-solicitud-desde' | translate">
            <mat-datepicker-toggle matSuffix [for]="pickerFechaSolicitudInicio"></mat-datepicker-toggle>
            <mat-datepicker #pickerFechaSolicitudInicio>
            </mat-datepicker>
          </mat-form-field>
        </div>

        <!-- Fecha hasta-->
        <div class="col">
          <mat-form-field sgiEndDate>
            <mat-label>{{'csp.autorizacion.fecha-solicitud-hasta' | translate}}</mat-label>
            <input matInput formControlName="fechaSolicitudFin" [matDatepicker]="pickerFechaSolicitudFin"
              [placeholder]="'csp.autorizacion.fecha-solicitud-hasta' | translate">
            <mat-datepicker-toggle matSuffix [for]="pickerFechaSolicitudFin"></mat-datepicker-toggle>
            <mat-datepicker #pickerFechaSolicitudFin>
            </mat-datepicker>
          </mat-form-field>
        </div>

        <!-- Estado -->
        <div class="col">
          <mat-form-field>
            <mat-label>{{'csp.autorizacion.estado' | translate}}</mat-label>
            <sgi-select-enum formControlName="estado" [enumMap]="ESTADO_MAP">
            </sgi-select-enum>
          </mat-form-field>
        </div>
      </div>

      <div class="buttons-final">
        <div class="col filter-button">
          <button color="primary" aria-label="Center Align" mat-raised-button (click)="onSearch()">
            <mat-icon>search</mat-icon> {{'btn.search'| translate}}
          </button>
          <button color="warn" aria-label="Center Align" (click)="onClearFilters()" mat-button>{{'btn.clean'|
            translate}}
          </button>
        </div>
      </div>
    </form>

    <table mat-table [dataSource]="autorizaciones$ | async" matSort matSortActive="id" matSortDirection="asc"
      matSortDisableClear>

      <!-- Fecha Solicitud -->
      <ng-container matColumnDef="fechaSolicitud">
        <th mat-header-cell *matHeaderCellDef> {{'csp.autorizacion.fecha-solicitud' | translate}} </th>
        <td mat-cell *matCellDef="let element"> {{element.estadoAutorizacion?.fecha | luxon:'shortDate'}}</td>
      </ng-container>

      <!-- Titulo Column -->
      <ng-container matColumnDef="tituloProyecto">
        <th mat-header-cell *matHeaderCellDef> {{'csp.autorizacion.titulo-proyecto' | translate}} </th>
        <td mat-cell *matCellDef="let element"> {{element.autorizacion?.tituloProyecto}}</td>
      </ng-container>

      <!-- Entidad Participacion Column -->
      <ng-container matColumnDef="entidadParticipacion">
        <th mat-header-cell *matHeaderCellDef> {{'csp.autorizacion.entidad-participacion' | translate}} </th>
        <td mat-cell *matCellDef="let element"> {{element.entidadPaticipacionNombre}}</td>
      </ng-container>

      <!-- Estado Column -->
      <ng-container matColumnDef="estado">
        <th mat-header-cell *matHeaderCellDef> {{'csp.autorizacion.estado' | translate}} </th>
        <td mat-cell *matCellDef="let element"> {{element.estadoAutorizacion?.estado}}</td>
      </ng-container>

      <!-- fechaEstado Column -->
      <ng-container matColumnDef="fechaEstado">
        <th mat-header-cell *matHeaderCellDef> {{'csp.autorizacion.fecha-estado' | translate}} </th>
        <td mat-cell *matCellDef="let element">{{element.fechaEstadoBorrador | luxon:'shortDate'}}</td>
      </ng-container>

      <!-- Acciones Column -->
      <ng-container matColumnDef="acciones">
        <th mat-header-cell *matHeaderCellDef> {{'label.actions' | translate}} </th>
        <td mat-cell *matCellDef="let element">
          <ng-container
            *ngIf="(this.isInvestigador && element.estadoAutorizacion.estado !== 'BORRADOR') || (!this.isInvestigador && element.estadoAutorizacion.estado === 'AUTORIZADA')">
            <a mat-button matTooltip="{{'btn.view' | translate}}" [routerLink]="[element.autorizacion.id]">
              <mat-icon color="primary">visibility</mat-icon>
            </a>
          </ng-container>
          <ng-container
            *ngIf="(this.isInvestigador && element.estadoAutorizacion.estado === 'BORRADOR') || (!this.isInvestigador && element.estadoAutorizacion.estado !== 'AUTORIZADA')">
            <a mat-button matTooltip="{{'btn.edit' | translate}}" [routerLink]="[element.autorizacion.id]">
              <mat-icon color="primary">border_color</mat-icon>
            </a>
          </ng-container>
          <ng-container>
            <button
              *ngIf="(this.isInvestigador && element.estadoAutorizacion.estado === 'BORRADOR') || (!this.isInvestigador && !mapCanBeDeleted.get(element.autorizacion.id))"
              mat-button matTooltip="{{'btn.delete' | translate}}"
              (click)="deleteAutorizacion(element.autorizacion.id)">
              <mat-icon color="warn">highlight_off</mat-icon>
            </button>
          </ng-container>

          <ng-container *sgiHasAuthorityForAnyUO="'CSP-AUT-INV-C'">
            <button *ngIf="(element.hasCertificadoVisible)" mat-button color="primary"
              matTooltip="{{'btn.autorizacion.descargar-certificado' | translate}}">
              <mat-icon color="primary">arrow_downward</mat-icon>
            </button>
          </ng-container>

          <ng-container *sgiHasAuthorityForAnyUO="'CSP-PRO-V'">
            <button mat-button matTooltip="{{'btn.autorizacion.ver-proyecto' | translate}}">
              <mat-icon color="primary">work</mat-icon>
            </button>
          </ng-container>
          <ng-container *sgiHasAuthorityForAnyUO="'CSP-CVPR-V'">
            <button mat-button matTooltip="{{'btn.autorizacion.ver-notificacion' | translate}}">
              <mat-icon color="primary">notifications</mat-icon>
            </button>
          </ng-container>

      </ng-container>
      <tr mat-header-row *matHeaderRowDef="columnas"></tr>
      <tr mat-row *matRowDef="let row; columns: columnas;"></tr>
    </table>
    <div class="paginator-export">
      <mat-paginator [pageSizeOptions]="elementosPagina" [length]="totalElementos" showFirstLastButtons>
      </mat-paginator>
    </div>
  </div>

  <sgi-menu-content-footer>
    <sgi-footer-crear *sgiHasAuthorityForAnyUO="'CSP-AUT-INV-C'" [texto]="textoCrear" [route]="ROUTE_NAMES.NEW">
    </sgi-footer-crear>
  </sgi-menu-content-footer>
</sgi-menu-content>