<sgi-menu-content>
  <div class="mat-elevation-z4">
    <!-- Buscador de presupuestos de proyecto a enviar al SGE -->
    <form class="formulario mat-elevation-z8" [formGroup]="formGroup" [fxLayout.xs]="fxLayoutProperties.xs"
      [fxLayout]="fxLayoutProperties.layout" fxLayoutGap="fxLayoutProperties.gap">

      <div fxFlex="100%" fxFlex.sm="50%" fxFlex.md="53%" [fxLayout.xs]="fxLayoutProperties.xs"
        [fxLayout]="fxLayoutProperties.layout" [fxLayoutGap]="fxLayoutProperties.gap" ngClass.gt-xs="ml-10">
        <!-- Anualidad -->
        <ng-container>
          <div [fxFlex.sm]="fxFlexProperties.sm" [fxFlex.md]="fxFlexProperties.md"
            [fxFlex.gt-md]="fxFlexProperties.gtMd" [fxFlexOrder]="fxFlexProperties.order">
            <mat-form-field>
              <mat-label>{{'csp.notificacion-presupuesto-sge.anualidad' | translate}}</mat-label>
              <input matInput type="number" placeholder="{{'csp.notificacion-presupuesto-sge.anualidad' | translate}}"
                formControlName="anualidad">
            </mat-form-field>
          </div>
        </ng-container>

        <!-- Titulo proyecto -->
        <ng-container>
          <div [fxFlex.sm]="fxFlexProperties.sm" [fxFlex.md]="fxFlexProperties.md"
            [fxFlex.gt-md]="fxFlexProperties.gtMd" [fxFlexOrder]="fxFlexProperties.order">
            <mat-form-field>
              <mat-label>{{'csp.notificacion-presupuesto-sge.titulo-proyecto' | translate}}</mat-label>
              <input matInput placeholder="{{'csp.notificacion-presupuesto-sge.titulo-proyecto' | translate}}"
                formControlName="tituloProyecto">
            </mat-form-field>
          </div>
        </ng-container>


        <!-- Estado -->
        <ng-container>
          <div [fxFlex.sm]="fxFlexProperties.sm" [fxFlex.md]="fxFlexProperties.md"
            [fxFlex.gt-md]="fxFlexProperties.gtMd" [fxFlexOrder]="fxFlexProperties.order">
            <mat-form-field>
              <mat-label>{{'csp.notificacion-presupuesto-sge.estado' | translate}}</mat-label>
              <mat-select matNativeControl formControlName="estado">
                <mat-option [value]="undefined"></mat-option>
                <mat-option *ngFor="let estado of ESTADO_MAP |  keyvalue" [value]="estado.key">
                  {{ estado.value | translate}}
                </mat-option>
              </mat-select>
            </mat-form-field>
          </div>
        </ng-container>

        <!-- Número Identificación SGE -->
        <ng-container>
          <div [fxFlex.sm]="fxFlexProperties.sm" [fxFlex.md]="fxFlexProperties.md"
            [fxFlex.gt-md]="fxFlexProperties.gtMd" [fxFlexOrder]="fxFlexProperties.order">
            <mat-form-field>
              <mat-label>{{'csp.notificacion-presupuesto-sge.numero-identificacion-sge' | translate}}</mat-label>
              <input matInput placeholder="{{'csp.notificacion-presupuesto-sge.numero-identificacion-sge' | translate}}"
                formControlName="numeroIdentificacionSge">
            </mat-form-field>
          </div>
        </ng-container>

        <!-- Fecha inicio desde-->
        <div [fxFlex.sm]="fxFlexProperties.sm" [fxFlex.md]="fxFlexProperties.md" [fxFlex.gt-md]="fxFlexProperties.gtMd"
          [fxFlexOrder]="fxFlexProperties.order">
          <mat-form-field>
            <mat-label>{{'csp.notificacion-presupuesto-sge.fecha-inicio-desde' | translate}}</mat-label>
            <input matInput formControlName="fechaInicioDesde" [matDatepicker]="pickerFechaInicioDesde"
              [placeholder]="'csp.notificacion-presupuesto-sge.fecha-inicio-desde' | translate">
            <mat-datepicker-toggle matSuffix [for]="pickerFechaInicioDesde"></mat-datepicker-toggle>
            <mat-datepicker #pickerFechaInicioDesde>
            </mat-datepicker>
          </mat-form-field>
        </div>

        <!-- Fecha inicio hasta-->
        <div [fxFlex.sm]="fxFlexProperties.sm" [fxFlex.md]="fxFlexProperties.md" [fxFlex.gt-md]="fxFlexProperties.gtMd"
          [fxFlexOrder]="fxFlexProperties.order">
          <mat-form-field sgiEndDate>
            <mat-label>{{'csp.notificacion-presupuesto-sge.fecha-inicio-hasta' | translate}}</mat-label>
            <input matInput formControlName="fechaInicioHasta" [matDatepicker]="pickerFechaInicioHasta"
              [placeholder]="'csp.notificacion-presupuesto-sge.fecha-inicio-hasta' | translate">
            <mat-datepicker-toggle matSuffix [for]="pickerFechaInicioHasta"></mat-datepicker-toggle>
            <mat-datepicker #pickerFechaInicioHasta>
            </mat-datepicker>
          </mat-form-field>
        </div>

        <!-- Fecha fin desde-->
        <div [fxFlex.sm]="fxFlexProperties.sm" [fxFlex.md]="fxFlexProperties.md" [fxFlex.gt-md]="fxFlexProperties.gtMd"
          [fxFlexOrder]="fxFlexProperties.order">
          <mat-form-field>
            <mat-label>{{'csp.notificacion-presupuesto-sge.fecha-fin-desde' | translate}}</mat-label>
            <input matInput formControlName="fechaFinDesde" [matDatepicker]="pickerFechaFinDesde"
              [placeholder]="'csp.notificacion-presupuesto-sge.fecha-fin-desde' | translate">
            <mat-datepicker-toggle matSuffix [for]="pickerFechaFinDesde"></mat-datepicker-toggle>
            <mat-datepicker #pickerFechaFinDesde>
            </mat-datepicker>
          </mat-form-field>
        </div>

        <!-- Fecha fin hasta-->
        <div [fxFlex.sm]="fxFlexProperties.sm" [fxFlex.md]="fxFlexProperties.md" [fxFlex.gt-md]="fxFlexProperties.gtMd"
          [fxFlexOrder]="fxFlexProperties.order">
          <mat-form-field sgiEndDate>
            <mat-label>{{'csp.notificacion-presupuesto-sge.fecha-fin-hasta' | translate}}</mat-label>
            <input matInput formControlName="fechaFinHasta" [matDatepicker]="pickerFechaFinHasta"
              [placeholder]="'csp.notificacion-presupuesto-sge.fecha-fin-hasta' | translate">
            <mat-datepicker-toggle matSuffix [for]="pickerFechaFinHasta"></mat-datepicker-toggle>
            <mat-datepicker #pickerFechaFinHasta>
            </mat-datepicker>
          </mat-form-field>
        </div>
      </div>

      <div class="buttons-final">
        <div class="col filter-button">
          <button color="primary" mat-raised-button (click)="onSearch()">
            <mat-icon>search</mat-icon> {{'btn.search'| translate}}
          </button>
          <button color="warn" (click)="onClearFilters()" mat-button>
            {{'btn.clean'| translate}}
          </button>
        </div>
      </div>
    </form>
    <!-- FIN Buscador de presupuestos de proyecto a enviar al SGE -->

    <!-- Listado de presupuestos -->
    <table mat-table class="mat-elevation-z8 table-unidad" [dataSource]="dataSource" matSort
      matSortActive="proyectoAnualidad.proyecto.titulo" matSortDirection="asc" matSortDisableClear>

      <ng-container matColumnDef="seleccionar">
        <th mat-header-cell *matHeaderCellDef>
          <mat-checkbox class="checkbox" color="primary" [checked]="isAllSelected()"
            (change)="checkAllEnvioSge($event)">
          </mat-checkbox>
        </th>
        <td mat-cell *matCellDef="let presupuesto">
          <mat-checkbox class="checkbox" color="primary" [checked]="isCheckend(presupuesto)"
            (change)="checkEnvioSge(presupuesto, $event)" [disabled]="presupuesto.enviadoSge">
          </mat-checkbox>
        </td>
      </ng-container>


      <!-- Titulo proyecto -->
      <ng-container matColumnDef="proyectoAnualidad.proyecto.titulo">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>
          {{'csp.notificacion-presupuesto-sge.titulo-proyecto' | translate}}
        </th>
        <td mat-cell *matCellDef="let presupuesto">{{presupuesto.proyectoTitulo}}</td>
      </ng-container>

      <!-- Acrónimo -->
      <ng-container matColumnDef="proyectoAnualidad.proyecto.acronimo">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>
          {{'csp.notificacion-presupuesto-sge.acronimo' | translate}}
        </th>
        <td mat-cell *matCellDef="let presupuesto">{{presupuesto.proyectoAcronimo}}</td>
      </ng-container>

      <!-- Fecha inicio -->
      <ng-container matColumnDef="proyectoAnualidad.proyecto.fechaInicio">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>
          {{'csp.notificacion-presupuesto-sge.fecha-inicio' | translate}}
        </th>
        <td mat-cell *matCellDef="let presupuesto">{{presupuesto.proyectoFechaInicio | luxon:'shortDate'}}</td>
      </ng-container>

      <!-- Fecha fin -->
      <ng-container matColumnDef="proyectoAnualidad.proyecto.fechaFin">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>
          {{'csp.notificacion-presupuesto-sge.fecha-fin' | translate}}
        </th>
        <td mat-cell *matCellDef="let presupuesto">{{presupuesto.proyectoFechaFin | luxon:'shortDate'}}</td>
      </ng-container>

      <!-- Estado -->
      <ng-container matColumnDef="proyectoAnualidad.proyecto.estado.estado">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>
          {{'csp.notificacion-presupuesto-sge.estado' | translate}}
        </th>
        <td mat-cell *matCellDef="let presupuesto">{{ESTADO_MAP.get(presupuesto.proyectoEstado) | translate}}</td>
      </ng-container>

      <!-- Presupuesto SGE Ref -->
      <ng-container matColumnDef="proyectoSgeRef">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>
          {{'csp.notificacion-presupuesto-sge.presupuesto-sge-ref' | translate}}
        </th>
        <td mat-cell *matCellDef="let presupuesto">{{presupuesto.proyectoSgeRef}}</td>
      </ng-container>

      <!-- Anualidad -->
      <ng-container matColumnDef="proyectoAnualidad.anio">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>
          {{'csp.notificacion-presupuesto-sge.anualidad' | translate}}
        </th>
        <td mat-cell *matCellDef="let presupuesto">{{presupuesto.anio}}</td>
      </ng-container>

      <!-- Total gastos -->
      <ng-container matColumnDef="totalGastos">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>
          {{'csp.notificacion-presupuesto-sge.total-gastos' | translate}}
        </th>
        <td mat-cell *matCellDef="let presupuesto">{{presupuesto.totalGastos}}</td>
      </ng-container>

      <!-- Total ingresos -->
      <ng-container matColumnDef="totalIngresos">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>
          {{'csp.notificacion-presupuesto-sge.total-ingresos' | translate}}
        </th>
        <td mat-cell *matCellDef="let presupuesto">{{presupuesto.totalIngresos}}</td>
      </ng-container>

      <!-- Enviado SGE -->
      <ng-container matColumnDef="enviadoSge">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>
          {{'csp.notificacion-presupuesto-sge.enviado-sge' | translate}}
        </th>
        <td mat-cell *matCellDef="let presupuesto">
          {{(presupuesto.enviadoSge ? 'label.si' : 'label.no') | translate}}
        </td>
      </ng-container>

      <!-- Acciones -->
      <ng-container matColumnDef="acciones">
        <th mat-header-cell *matHeaderCellDef> {{'label.actions' | translate}} </th>
        <td mat-cell *matCellDef="let presupuesto">
          <ng-container *sgiHasAuthorityForAnyUO="'CSP-PRO-E'">
            <a mat-icon-button color="primary" matTooltip="{{'btn.view' | translate}}"
              (click)="showPoyectoAnualidad(presupuesto.proyectoId, presupuesto.id)">
              <mat-icon>visibility</mat-icon>
            </a>
          </ng-container>
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="columnas"></tr>
      <tr mat-row *matRowDef="let row; columns: columnas;"></tr>
    </table>
    <mat-paginator [pageSizeOptions]="elementosPagina" [length]="totalElementos" showFirstLastButtons>
    </mat-paginator>
  </div>
  <ng-container>
    <div class="separation-button">
      <button color="three" aria-label="Center Align" mat-raised-button (click)="notificarSge()">
        <mat-icon color="accent">send</mat-icon>
        {{ 'csp.notificacion-presupuesto-sge.notificar-sge' | translate }}
      </button>
    </div>
  </ng-container>
</sgi-menu-content>