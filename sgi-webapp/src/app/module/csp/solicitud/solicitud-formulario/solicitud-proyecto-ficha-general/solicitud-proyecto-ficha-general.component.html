<sgi-fragment title="{{'label.datos-generales' | translate}} - {{'label.ficha-general' | translate}}">

  <form [formGroup]="formGroup">

    <div [fxLayout.xs]="fxLayoutProperties.xs" [fxLayout]="fxLayoutProperties.layout"
      [fxLayoutGap]="fxLayoutProperties.gap" ngClass.gt-xs="ml-10">

      <!-- Acronimo -->
      <div [fxFlex.sm]="fxFlexProperties.sm" [fxFlex.md]="fxFlexProperties.md" [fxFlex.gt-md]="fxFlexProperties.gtMd"
        [fxFlexOrder]="fxFlexProperties.order">
        <mat-form-field class="input-form">
          <mat-label>{{'csp.solicitud-datos-proyecto-ficha-general.acronimo' | translate}}</mat-label>
          <input matInput formControlName="acronimo" type="text" id="acronimo"
            placeholder="{{'csp.solicitud-datos-proyecto-ficha-general.acronimo' | translate}}">
          <mat-error *ngIf="formGroup.controls.acronimo.errors?.maxlength">
            {{'error.maxlength.entity' | translate:msgParamAcronimoEntity}}
          </mat-error>
        </mat-form-field>
      </div>


    </div>

    <div [fxLayout.xs]="fxLayoutProperties.xs" [fxLayout]="fxLayoutProperties.layout"
      [fxLayoutGap]="fxLayoutProperties.gap" ngClass.gt-xs="ml-10">
      <div [fxFlex.sm]="fxFlexProperties.sm" [fxFlex.md]="fxFlexProperties.md" [fxFlex.gt-md]="fxFlexProperties.gtMd"
        [fxFlexOrder]="fxFlexProperties.order">
        <mat-form-field class="input-form">
          <mat-label>{{'csp.solicitud-datos-proyecto-ficha-general.codigo-externo' | translate}}</mat-label>
          <input matInput formControlName="codExterno" type="text"
            placeholder="{{'csp.solicitud-datos-proyecto-ficha-general.codigo-externo' | translate}}">
          <mat-error *ngIf="formGroup.controls.codExterno.errors?.maxlength">
            {{'error.maxlength.entity' | translate:msgParamCodExternoEntity}}
          </mat-error>
        </mat-form-field>
      </div>
    </div>

    <div [fxLayout.xs]="fxLayoutProperties.xs" [fxLayout]="fxLayoutProperties.layout"
      [fxLayoutGap]="fxLayoutProperties.gap" ngClass.gt-xs="ml-10">

      <!-- Duración -->
      <div [fxFlex.sm]="fxFlexProperties.sm" [fxFlex.md]="fxFlexProperties.md" [fxFlex.gt-md]="fxFlexProperties.gtMd"
        [fxFlexOrder]="fxFlexProperties.order">
        <mat-form-field class="input-form">
          <mat-label>{{'csp.solicitud-datos-proyecto-ficha-general.duracion' | translate}}</mat-label>
          <input matInput formControlName="duracion" type="number" id="duracion" min="0" step="1"
            placeholder="{{'csp.solicitud-datos-proyecto-ficha-general.duracion' | translate}}">
          <mat-error *ngIf="formGroup.controls.duracion.errors?.min">
            {{'error.csp.solicitud-datos-proyecto-ficha-general.duracion.min' | translate}}
          </mat-error>
          <mat-error *ngIf="formGroup.controls.duracion.errors?.max">
            {{'error.csp.solicitud-datos-proyecto-ficha-general.duracion.max' | translate}}
          </mat-error>
        </mat-form-field>
      </div>

    </div>

    <div [fxLayout.xs]="fxLayoutProperties.xs" [fxLayout]="fxLayoutProperties.layout"
      [fxLayoutGap]="fxLayoutProperties.gap" ngClass.gt-xs="ml-10">

      <!-- Coordinado -->
      <div [fxFlex.sm]="fxFlexProperties.sm" [fxFlex.md]="fxFlexProperties.md" [fxFlex.gt-md]="fxFlexProperties.gtMd"
        [fxFlexOrder]="fxFlexProperties.order">
        <mat-form-field class="input-form">
          <mat-label>{{'csp.solicitud-datos-proyecto-ficha-general.proyecto-coordinado' | translate}}</mat-label>
          <sgi-select-boolean formControlName="coordinado" required>
          </sgi-select-boolean>
          <sgi-field-info matSuffix [visible]="(formPart.hasPopulatedSocios$ | async) && (formPart.coordinado$ | async)"
            message="{{'msg.csp.solicitud-proyecto.unmodifiable-due-socios-dependencies.info' | translate}}">
          </sgi-field-info>
          <mat-error *ngIf="formGroup.controls.coordinado.errors?.required">
            {{'error.required.entity' | translate:msgParamCoordinadoEntity}}
          </mat-error>
        </mat-form-field>
      </div>

      <!-- Coordinador Externo -->
      <div [fxFlex.sm]="fxFlexProperties.sm" [fxFlex.md]="fxFlexProperties.md" [fxFlex.gt-md]="fxFlexProperties.gtMd"
        [fxFlexOrder]="fxFlexProperties.order" *ngIf="(formPart.coordinado$ | async)">
        <mat-form-field class="input-form">
          <mat-label>{{'csp.solicitud-datos-proyecto-ficha-general.coordinador-externo' | translate}}</mat-label>
          <sgi-select-boolean matNativeControl formControlName="coordinadorExterno"
            [required]="(formPart.coordinado$ | async)">
          </sgi-select-boolean>
          <sgi-field-info matSuffix [visible]="(formPart.hasPopulatedPeriodosSocios$ | async) && !formPart.readonly"
            message="{{'msg.csp.solicitud-proyecto.unmodifiable-due-periodos-socios-dependencies.info' | translate}}">
          </sgi-field-info>
          <sgi-field-info matSuffix
            [visible]="!(formPart.hasAnySolicitudProyectoSocioWithRolCoordinador$ | async) && (formPart.coordinadorExterno$ | async)"
            message="{{'info.csp.solicitud-proyecto-socio.socio-con-rol-coordinador.no-informado.tooltip' | translate}}">
          </sgi-field-info>
          <mat-error *ngIf="formGroup.controls.coordinadorExterno.errors?.required">
            {{'error.required.entity' | translate:msgParamCoordinadorExternoEntity}}
          </mat-error>
        </mat-form-field>
      </div>

      <!-- Colaborativo -->
      <div [fxFlex.sm]="fxFlexProperties.sm" [fxFlex.md]="fxFlexProperties.md" [fxFlex.gt-md]="fxFlexProperties.gtMd"
        [fxFlexOrder]="fxFlexProperties.order" *ngIf="formGroup.controls.coordinado.value">
        <mat-form-field class="input-form">
          <mat-label>{{'csp.solicitud-datos-proyecto-ficha-general.proyecto-colaborativo' | translate}}</mat-label>
          <sgi-select-boolean formControlName="colaborativo">
            <mat-option [value]="true">{{'label.si' | translate}}</mat-option>
            <mat-option [value]="false">{{'label.no' | translate}}</mat-option>
          </sgi-select-boolean>
        </mat-form-field>
      </div>

    </div>

    <div [fxLayout.xs]="fxLayoutProperties.xs" [fxLayout]="fxLayoutProperties.layout"
      [fxLayoutGap]="fxLayoutProperties.gap" ngClass.gt-xs="ml-10">

      <!-- Tipo desglose presupuesto-->
      <div [fxFlex.sm]="fxFlexProperties.sm" [fxFlex.md]="fxFlexProperties.md" [fxFlex.gt-md]="fxFlexProperties.gtMd"
        [fxFlexOrder]="fxFlexProperties.order">
        <mat-form-field class="input-form">
          <mat-label>{{'csp.solicitud-datos-proyecto-ficha-general.tipo-desglose-presupuesto' | translate}}</mat-label>
          <sgi-select-enum formControlName="tipoDesglosePresupuesto" [enumMap]="TIPO_PRESUPUESTO_MAP">
          </sgi-select-enum>
          <mat-error *ngIf="formGroup.controls.tipoDesglosePresupuesto.errors?.required">
            {{'error.required.entity' | translate:msgParamTipoDesglosePresupuestoEntity}}
          </mat-error>
        </mat-form-field>
      </div>

    </div>

    <div>

      <!-- Objetivos -->
      <div [fxLayout]="fxLayoutProperties.layout" [fxLayoutAlign]="fxLayoutProperties.layoutAlign">

        <div [fxFlex.sm]="fxFlexProperties100.sm" [fxFlex.md]="fxFlexProperties100.md"
          [fxFlex.gt-md]="fxFlexProperties100.gtMd" [fxFlexOrder]="fxFlexProperties100.order">
          <mat-form-field fxFill>
            <mat-label>{{'csp.solicitud-datos-proyecto-ficha-general.objetivos' | translate}}</mat-label>
            <textarea matInput formControlName="objetivos" id="objetivos"
              placeholder="{{'csp.solicitud-datos-proyecto-ficha-general.objetivos' | translate}}"></textarea>
          </mat-form-field>
        </div>

      </div>

    </div>

    <div>

      <!-- Interesés -->
      <div [fxLayout]="fxLayoutProperties.layout" [fxLayoutAlign]="fxLayoutProperties.layoutAlign">

        <div [fxFlex.sm]="fxFlexProperties100.sm" [fxFlex.md]="fxFlexProperties100.md"
          [fxFlex.gt-md]="fxFlexProperties100.gtMd" [fxFlexOrder]="fxFlexProperties100.order">
          <mat-form-field fxFill>
            <mat-label>{{'csp.solicitud-datos-proyecto-ficha-general.justificacion-interes' | translate}}</mat-label>
            <textarea matInput formControlName="intereses" id="intereses"
              placeholder="{{'csp.solicitud-datos-proyecto-ficha-general.justificacion-interes' | translate}}"></textarea>
          </mat-form-field>
        </div>

      </div>

    </div>

    <div>

      <!-- Resultados Previstos -->
      <div [fxLayout]="fxLayoutProperties.layout" [fxLayoutAlign]="fxLayoutProperties.layoutAlign">

        <div [fxFlex.sm]="fxFlexProperties100.sm" [fxFlex.md]="fxFlexProperties100.md"
          [fxFlex.gt-md]="fxFlexProperties100.gtMd" [fxFlexOrder]="fxFlexProperties100.order">
          <mat-form-field fxFill>
            <mat-label>{{'csp.solicitud-datos-proyecto-ficha-general.resultados' | translate}}</mat-label>
            <textarea matInput formControlName="resultadosPrevistos" id="resultadosPrevistos"
              placeholder="{{'csp.solicitud-datos-proyecto-ficha-general.resultados' | translate}}"></textarea>
          </mat-form-field>
        </div>

      </div>

    </div>

  </form>

  <!-- Áreas temáticas -->
  <div class="separation-button" *ngIf="formPart.hasConvocatoria">
    <h3>{{'list.entity' | translate:msgParamAreaTematicaEntities}}</h3>
    <div class="mat-elevation-z4">
      <table mat-table [dataSource]="convocatoriaAreaTematicas" matSort matSortActive="id" matSortDirection="asc"
        matSortDisableClear>
        <ng-container matColumnDef="nombreRaizArbol">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>
            {{'list.entity' | translate:msgParamAreaEntities}}
          </th>
          <td mat-cell *matCellDef="let data">{{data.rootTree?.nombre}}</td>
        </ng-container>
        <ng-container matColumnDef="areaTematicaConvocatoria">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>
            {{'csp.area-tematica.nombre.convocatoria' | translate}}
          </th>
          <td mat-cell *matCellDef="let data"> {{data.areaTematicaConvocatoria?.nombre}} </td>
        </ng-container>
        <ng-container matColumnDef="areaTematicaSolicitud">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>
            {{'csp.area-tematica.nombre.solicitud' | translate}}
          </th>
          <td mat-cell *matCellDef="let data"> {{data.areaTematicaSolicitud?.nombre}} </td>
        </ng-container>
        <ng-container matColumnDef="acciones">
          <th mat-header-cell *matHeaderCellDef>{{'label.actions' | translate}}
          </th>
          <td mat-cell *matCellDef="let data">
            <ng-container>
              <button *ngIf="!this.formPart.readonly" mat-button
                matTooltip="{{'csp.solicitud.select-area' | translate}}" (click)="openModal(data)">
                <mat-icon color="primary">border_color</mat-icon>
              </button>
            </ng-container>
          </td>
        </ng-container>
        <tr mat-header-row *matHeaderRowDef="columns"></tr>
        <tr mat-row *matRowDef="let row; columns: columns;"></tr>
      </table>
    </div>
  </div>
</sgi-fragment>