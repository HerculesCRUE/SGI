<sgi-fragment title="{{'menu.csp.solicitudes.entidades-financiadoras' | translate}}">

  <!-- Entidades financiadoras convocatoria -->
  <div class="entidades-financiadoras-convocatoria">
    <mat-label>{{'list.entity' | translate:msgParamConvocatoriaEntity}}</mat-label>

    <div class="mat-elevation-z4">
      <table mat-table [dataSource]="dataSourceEntidadesFinanciadorasConvocatoria" matSort
        #sortEntidadesFinanciadorasConvocatoria="matSort" matSortActive="id" matSortDirection="asc" matSortDisableClear>

        <!-- Nombre Column -->
        <ng-container matColumnDef="nombre">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>
            {{'csp.solicitud-entidad-financiadora.nombre' | translate}}
          </th>
          <td mat-cell *matCellDef="let element" sgempNotFoundError [model]="element.empresa">
            {{element.empresa?.nombre}}
          </td>
        </ng-container>

        <!-- CIF Column -->
        <ng-container matColumnDef="cif">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>
            {{'csp.solicitud-entidad-financiadora.cif' | translate}}
          </th>
          <td mat-cell *matCellDef="let element">
            {{element.empresa?.numeroIdentificacion}}
          </td>
        </ng-container>

        <!-- Fuente financiacion Column -->
        <ng-container matColumnDef="fuenteFinanciacion">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>
            {{'csp.solicitud-entidad-financiadora.fuente-financiacion' | translate}}
          </th>
          <td mat-cell *matCellDef="let element">
            {{element.fuenteFinanciacion?.nombre}}
          </td>
        </ng-container>

        <!-- Ambito Column -->
        <ng-container matColumnDef="ambito">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>
            {{'csp.solicitud-entidad-financiadora.ambito' | translate}}
          </th>
          <td mat-cell *matCellDef="let element">
            {{element.fuenteFinanciacion?.tipoAmbitoGeografico?.nombre}}
          </td>
        </ng-container>

        <!-- Tipo financiacion Column -->
        <ng-container matColumnDef="tipoFinanciacion">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>
            {{'csp.solicitud-entidad-financiadora.tipo-financiacion' | translate}}
          </th>
          <td mat-cell *matCellDef="let element">
            {{element.tipoFinanciacion?.nombre}}
          </td>
        </ng-container>

        <!-- Porcentaje financiacion Column -->
        <ng-container matColumnDef="porcentajeFinanciacion">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>
            {{'csp.solicitud-entidad-financiadora.porcentaje-financiacion' | translate}}
          </th>
          <td mat-cell *matCellDef="let element">
            {{element.porcentajeFinanciacion | number:'2.2-2'}}
          </td>
        </ng-container>

        <!-- Importe financiacion Column -->
        <ng-container matColumnDef="importeFinanciacion">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>
            {{'csp.solicitud-entidad-financiadora.importe-financiacion' | translate}}
          </th>
          <td mat-cell *matCellDef="let element">
            {{element.importeFinanciacion | number:'1.2-2'}}}
          </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="displayedColumnsEntidadesFinanciadorasConvocatoria"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumnsEntidadesFinanciadorasConvocatoria;"></tr>
      </table>
      <mat-paginator #paginatorEntidadesFinanciadorasConvocatoria [pageSizeOptions]="elementosPagina"
        showFirstLastButtons>
      </mat-paginator>

    </div>

    <hr />

    <!-- Entidades financiadoras solicitud -->
    <div class="entidades-financiadoras-ajenas">
      <h3>{{'list.entity' | translate:msgParamAjenaEntity}}</h3>

      <div class="mat-elevation-z4">
        <table class="table-entidades-financiadoras-ajenas" mat-table
          [dataSource]="dataSourceEntidadesFinanciadorasAjenas" matSort #sortEntidadesFinanciadorasAjenas="matSort"
          matSortActive="id" matSortDirection="asc" matSortDisableClear>

          <!-- Nombre Column -->
          <ng-container matColumnDef="nombre">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>
              {{'csp.solicitud-entidad-financiadora.nombre' | translate}}
            </th>
            <td mat-cell *matCellDef="let wrapper" sgempNotFoundError [model]="wrapper.value.empresa">
              {{wrapper.value.empresa?.nombre}}
            </td>
          </ng-container>

          <!-- CIF Column -->
          <ng-container matColumnDef="cif">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>
              {{'csp.solicitud-entidad-financiadora.cif' | translate}}
            </th>
            <td mat-cell *matCellDef="let wrapper">
              {{wrapper.value.empresa?.numeroIdentificacion}}
            </td>
          </ng-container>

          <!-- Fuente financiacion Column -->
          <ng-container matColumnDef="fuenteFinanciacion">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>
              {{'csp.solicitud-entidad-financiadora.fuente-financiacion' | translate}}
            </th>
            <td mat-cell *matCellDef="let wrapper">
              {{wrapper.value.fuenteFinanciacion?.nombre}}
            </td>
          </ng-container>

          <!-- Ambito Column -->
          <ng-container matColumnDef="ambito">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>
              {{'csp.solicitud-entidad-financiadora.ambito' | translate}}
            </th>
            <td mat-cell *matCellDef="let wrapper">
              {{wrapper.value.fuenteFinanciacion?.tipoAmbitoGeografico?.nombre}}
            </td>
          </ng-container>

          <!-- Tipo financiacion Column -->
          <ng-container matColumnDef="tipoFinanciacion">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>
              {{'csp.solicitud-entidad-financiadora.tipo-financiacion' | translate}}
            </th>
            <td mat-cell *matCellDef="let wrapper">
              {{wrapper.value.tipoFinanciacion?.nombre}}
            </td>
          </ng-container>

          <!-- Porcentaje financiacion Column -->
          <ng-container matColumnDef="porcentajeFinanciacion">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>
              {{'csp.solicitud-entidad-financiadora.porcentaje-financiacion' | translate}}
            </th>
            <td mat-cell *matCellDef="let wrapper">
              {{wrapper.value.porcentajeFinanciacion | number:'2.2-2'}}
            </td>
          </ng-container>

          <!-- Importe financiacion Column -->
          <ng-container matColumnDef="importeFinanciacion">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>
              {{'csp.solicitud-entidad-financiadora.importe-financiacion' | translate}}
            </th>
            <td mat-cell *matCellDef="let wrapper">
              {{wrapper.value.importeFinanciacion | number:'1.2-2'}}
            </td>
          </ng-container>

          <!-- Acciones Column -->
          <ng-container matColumnDef="acciones">
            <th mat-header-cell *matHeaderCellDef> {{'label.actions' | translate}} </th>
            <td mat-cell *matCellDef="let wrapper">
              <ng-container>
                <button color="primary" *ngIf="this.formPart.readonly" mat-icon-button
                  matTooltip="{{'btn.view' | translate}}" (click)="openModal(wrapper)">
                  <mat-icon>visibility</mat-icon>
                </button>
                <button color="primary" *ngIf="!this.formPart.readonly" mat-icon-button
                  matTooltip="{{'btn.edit' | translate}}" (click)="openModal(wrapper)">
                  <mat-icon>border_color</mat-icon>
                </button>
                <button color="warn"
                  *ngIf="!this.formPart.readonly && wrapper.value.hasDesglosePresupuesto != null && !wrapper.value.hasDesglosePresupuesto"
                  mat-icon-button matTooltip="{{'btn.delete' | translate}}"
                  (click)="deleteEntidadFinanciadora(wrapper)">
                  <mat-icon>highlight_off</mat-icon>
                </button>
                <span class="container-field-info">
                  <sgi-field-info matSuffix
                    [visible]="!this.formPart.readonly && wrapper.value.hasDesglosePresupuesto != null && wrapper.value.hasDesglosePresupuesto"
                    message="{{'msg.csp.solicitud-entidad-financiadora.con-desglose-presupuesto' | translate}}">
                  </sgi-field-info>
                </span>
              </ng-container>
            </td>
          </ng-container>
          <tr mat-header-row *matHeaderRowDef="displayedColumnsEntidadesFinanciadorasAjenas"></tr>
          <tr mat-row *matRowDef="let row; columns: displayedColumnsEntidadesFinanciadorasAjenas;"></tr>
        </table>
        <mat-paginator #paginatorEntidadesFinanciadorasAjenas [pageSizeOptions]="elementosPagina" showFirstLastButtons>
        </mat-paginator>
      </div>
    </div>
    <div class="separation-button" *ngIf="!formPart.readonly">
      <button color="three" mat-button mat-raised-button (click)="openModal()">
        <mat-icon color="accent">add_circle</mat-icon>
        {{ 'btn.add.entity' | translate:msgParamEntity }}
      </button>
    </div>
  </div>

</sgi-fragment>