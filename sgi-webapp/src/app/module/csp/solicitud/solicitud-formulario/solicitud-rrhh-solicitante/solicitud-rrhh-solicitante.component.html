<sgi-fragment
  title="{{'menu.csp.solicitud.solicitud-rrhh' | translate}} - {{'menu.csp.solicitud.solicitud-rrhh.solicitante' | translate}}">

  <form [formGroup]="formGroup" fxLayout="column">
    <div fxFlex fxLayout="row" fxLayoutGap="10px" *ngIf="!this.formPart.isInvestigador">
      <!-- Solicitante -->
      <mat-form-field fxFlex="0 1 calc((100% - 10px) / 2)">
        <mat-label>{{'csp.solicitud.solicitud-rrhh.solicitante' | translate}}</mat-label>
        <sgi-select-persona placeholder="{{'csp.solicitud.solicitud-rrhh.solicitante' | translate}}"
          formControlName="solicitante" [tipoColectivo]="tipoColectivoSolicitante"
          [required]="formPart.isSolicitanteRequired">
        </sgi-select-persona>
        <mat-error *ngIf="formGroup.controls.solicitante.errors?.required">
          {{'error.required.entity' | translate:msgParamSolicitanteEntity}}
        </mat-error>
      </mat-form-field>
    </div>

    <!-- Mensaje de advertencia Solicitante -->
    <div fxFlex fxLayout="row" *ngIf="!this.formPart.isInvestigador" class="info-message tooltip-inv">
      <mat-icon class="info-icon">info</mat-icon>
      {{'msg.csp.solicitud.solicitud-rrhh.solicitante' |translate}}
    </div>

    <!-- Solicitante externo -->
    <ng-container formGroupName="solicitanteExterno">
      <div fxFlex fxLayout="row" fxLayoutGap="10px">
        <!-- Nombre -->
        <mat-form-field fxFlex="0 1 calc((100% - (10px * 2)) / 3)">
          <mat-label>{{'csp.solicitud.solicitud-rrhh.nombre' | translate}}</mat-label>
          <input matInput type="text" placeholder="{{'csp.solicitud.solicitud-rrhh.nombre' | translate}}"
            formControlName="nombre" [required]="!formGroup.controls.solicitanteExterno.disabled">
          <mat-error *ngIf="formGroup.hasError('required','solicitanteExterno.nombre')">
            {{ 'error.required.entity' | translate:msgParamNombreEntity }}
          </mat-error>
        </mat-form-field>

        <!-- Apellidos -->
        <mat-form-field fxFlex="0 1 calc((100% - (10px * 2)) / 3 * 2 + 10px)">
          <mat-label>{{'csp.solicitud.solicitud-rrhh.apellidos' | translate}}</mat-label>
          <input matInput type="text" placeholder="{{'csp.solicitud.solicitud-rrhh.apellidos' | translate}}"
            formControlName="apellidos" [required]="!formGroup.controls.solicitanteExterno.disabled">
          <mat-error *ngIf="formGroup.hasError('required','solicitanteExterno.apellidos')">
            {{ 'error.required.entity' | translate:msgParamApellidosEntity }}
          </mat-error>
        </mat-form-field>
      </div>

      <div fxFlex fxLayout="row" fxLayoutGap="10px">
        <!-- Tipo documento -->
        <mat-form-field>
          <mat-label>{{'csp.solicitud.solicitud-rrhh.tipo-documento' | translate}}</mat-label>
          <sgi-sgp-select-tipo-documento formControlName="tipoDocumento"
            [required]="!formGroup.controls.solicitanteExterno.disabled">
          </sgi-sgp-select-tipo-documento>
          <mat-error *ngIf="formGroup.hasError('required','solicitanteExterno.tipoDocumento')">
            {{ 'error.required.entity' | translate:msgParamTipoDocumentoEntity }}
          </mat-error>
        </mat-form-field>

        <!-- Numero documento -->
        <mat-form-field>
          <mat-label>{{'csp.solicitud.solicitud-rrhh.numero-documento' | translate}}</mat-label>
          <input matInput type="text" placeholder="{{'csp.solicitud.solicitud-rrhh.numero-documento' | translate}}"
            formControlName="numeroDocumento" [required]="!formGroup.controls.solicitanteExterno.disabled">
          <mat-error *ngIf="formGroup.hasError('required','solicitanteExterno.numeroDocumento')">
            {{ 'error.required.entity' | translate:msgParamNumeroDocumentoEntity }}
          </mat-error>
        </mat-form-field>

        <!-- Sexo -->
        <mat-form-field>
          <mat-label>{{'csp.solicitud.solicitud-rrhh.sexo' | translate}}</mat-label>
          <sgi-select-sexo formControlName="sexo">
          </sgi-select-sexo>
        </mat-form-field>
      </div>

      <div fxFlex fxLayout="row" fxLayoutGap="10px">
        <!-- Fecha nacimiento -->
        <mat-form-field fxFlex="0 1 calc((100% - (10px * 2)) / 3)">
          <mat-label>{{'csp.solicitud.solicitud-rrhh.fecha-nacimiento' | translate}}</mat-label>
          <input matInput formControlName="fechaNacimiento" [matDatepicker]="pickerNacimiento" />
          <mat-datepicker-toggle matSuffix [for]="pickerNacimiento"></mat-datepicker-toggle>
          <mat-datepicker #pickerNacimiento></mat-datepicker>
        </mat-form-field>

        <!-- Pais nacimiento -->
        <mat-form-field fxFlex="0 1 calc((100% - (10px * 2)) / 3)">
          <mat-label>{{'csp.solicitud.solicitud-rrhh.pais-nacimiento' | translate}}</mat-label>
          <sgi-select-pais formControlName="paisNacimiento">
          </sgi-select-pais>
        </mat-form-field>
      </div>

      <div fxFlex fxLayout="row" fxLayoutGap="10px" *ngIf="!!!formGroup.controls.solicitante.value">
        <!-- Telefono -->
        <mat-form-field fxFlex="0 1 calc((100% - (10px * 2)) / 3)">
          <mat-label>{{'csp.solicitud.solicitud-rrhh.telefono' | translate:MSG_PARAMS.CARDINALIRY.SINGULAR}}</mat-label>
          <input matInput type="text"
            placeholder="{{'csp.solicitud.solicitud-rrhh.telefono' | translate:MSG_PARAMS.CARDINALIRY.SINGULAR}}"
            formControlName="telefono" [required]="!formGroup.controls.solicitanteExterno.disabled">
          <mat-error *ngIf="formGroup.hasError('required','solicitanteExterno.telefono')">
            {{ 'error.required.entity' | translate:msgParamTelefonoEntity }}
          </mat-error>
        </mat-form-field>

        <!-- Email -->
        <mat-form-field fxFlex="0 1 calc((100% - (10px * 2)) / 3 * 2 + 10px)">
          <mat-label>{{'csp.solicitud.solicitud-rrhh.email' | translate:MSG_PARAMS.CARDINALIRY.SINGULAR}}</mat-label>
          <input matInput type="text"
            placeholder="{{'csp.solicitud.solicitud-rrhh.email' | translate:MSG_PARAMS.CARDINALIRY.SINGULAR}}"
            formControlName="email" [required]="!formGroup.controls.solicitanteExterno.disabled">
          <mat-error *ngIf="formGroup.hasError('required','solicitanteExterno.email')">
            {{ 'error.required.entity' | translate:msgParamEmailEntity }}
          </mat-error>
          <mat-error *ngIf="formGroup.hasError('email','solicitanteExterno.email')">
            {{ 'error.email.incorrect.format' | translate:msgParamEmailEntity }}
          </mat-error>
        </mat-form-field>
      </div>

      <div fxFlex fxLayout="row" fxLayoutGap="10px" *ngIf="!!formGroup.controls.solicitante.value">
        <div fxLayout="column" fxFlex="0 1 calc((100% - (10px * 2)) / 3)">
          <h3>{{'csp.solicitud.solicitud-rrhh.telefono' | translate:MSG_PARAMS.CARDINALIRY.PLURAL}}</h3>
          <div class="mat-elevation-z4">
            <table mat-table [dataSource]="telefonos" matSort matSortActive="nombre" matSortDirection="asc"
              matSortDisableClear>
              <!-- Telefono Column -->
              <ng-container matColumnDef="telefono">
                <th mat-header-cell *matHeaderCellDef mat-sort-header>
                  {{'csp.solicitud.solicitud-rrhh.telefono' | translate:MSG_PARAMS.CARDINALIRY.SINGULAR}}
                </th>
                <td mat-cell *matCellDef="let data">
                  {{data}}
                </td>
              </ng-container>
              <tr mat-header-row *matHeaderRowDef="columnsTelefonos"></tr>
              <tr mat-row *matRowDef="let row; columns: columnsTelefonos"></tr>
            </table>
          </div>
        </div>
        <div fxLayout="column" fxFlex="0 1 calc((100% - (10px * 2)) / 3)">
          <h3>{{'csp.solicitud.solicitud-rrhh.email' | translate:MSG_PARAMS.CARDINALIRY.PLURAL}}</h3>
          <div class="mat-elevation-z4">
            <table mat-table [dataSource]="emails" matSort matSortActive="nombre" matSortDirection="asc"
              matSortDisableClear>
              <!-- Email Column -->
              <ng-container matColumnDef="email">
                <th mat-header-cell *matHeaderCellDef mat-sort-header>
                  {{'csp.solicitud.solicitud-rrhh.email' | translate:MSG_PARAMS.CARDINALIRY.SINGULAR}}
                </th>
                <td mat-cell *matCellDef="let data">
                  {{data.email}}
                </td>
              </ng-container>
              <tr mat-header-row *matHeaderRowDef="columnsEmails"></tr>
              <tr mat-row *matRowDef="let row; columns: columnsEmails"></tr>
            </table>
          </div>
        </div>
      </div>

      <!-- Direccion contacto -->
      <fieldset fxFlex fxLayout="column" class="margin-fieldset">
        <legend>{{'csp.solicitud.solicitud-rrhh.direccion-contacto' | translate}}</legend>

        <div fxFlex fxLayout="row" fxLayoutGap="10px">
          <!-- Direccion -->
          <mat-form-field>
            <mat-label>{{'csp.solicitud.solicitud-rrhh.direccion' | translate}}</mat-label>
            <input matInput type="text" placeholder="{{'csp.solicitud.solicitud-rrhh.direccion' | translate}}"
              formControlName="direccionContacto">
          </mat-form-field>
        </div>

        <div fxFlex fxLayout="row" fxLayoutGap="10px">
          <!-- Pais -->
          <mat-form-field fxFlex>
            <mat-label>{{'csp.solicitud.solicitud-rrhh.pais' | translate}}</mat-label>
            <sgi-select-pais formControlName="paisContacto">
            </sgi-select-pais>
          </mat-form-field>

          <!-- Comunidad autonoma -->
          <mat-form-field fxFlex>
            <mat-label>{{'csp.solicitud.solicitud-rrhh.comunidad-autonoma' | translate}}</mat-label>
            <sgi-select-comunidad-autonoma formControlName="comunidadAutonomaContacto"
              [paisRef]="formGroup.get('solicitanteExterno.paisContacto').value?.id">
            </sgi-select-comunidad-autonoma>
          </mat-form-field>

          <!-- Provincia -->
          <mat-form-field fxFlex>
            <mat-label>{{'csp.solicitud.solicitud-rrhh.provincia' | translate}}</mat-label>
            <sgi-select-provincia formControlName="provinciaContacto"
              [comunidadAutonomaRef]="formGroup.get('solicitanteExterno.comunidadAutonomaContacto').value?.id">
            </sgi-select-provincia>
          </mat-form-field>
        </div>

        <div fxFlex fxLayout="row" fxLayoutGap="10px">
          <!-- Localidad -->
          <mat-form-field fxFlex="0 1 calc((100% - (10px * 2)) / 3)">
            <mat-label>{{'csp.solicitud.solicitud-rrhh.localidad' | translate}}</mat-label>
            <input matInput type="text" placeholder="{{'csp.solicitud.solicitud-rrhh.localidad' | translate}}"
              formControlName="localidadContacto">
          </mat-form-field>

          <!-- Codigo postal -->
          <mat-form-field fxFlex="0 1 calc((100% - (10px * 2)) / 3)">
            <mat-label>{{'csp.solicitud.solicitud-rrhh.codigo-postal' | translate}}</mat-label>
            <input matInput type="text" placeholder="{{'csp.solicitud.solicitud-rrhh.codigo-postal' | translate}}"
              formControlName="codigoPostalContacto">
          </mat-form-field>
        </div>
      </fieldset>
    </ng-container>

    <!-- Mensaje de advertencia Solicitante -->
    <div fxFlex fxLayout="row" *ngIf="this.formPart.isInvestigador" class="info-message tooltip-inv">
      <mat-icon class="info-icon">info</mat-icon>
      {{'msg.csp.solicitud.solicitud-rrhh.solicitante-inv' |translate}}
    </div>

    <div fxFlex fxLayout="row" fxLayoutGap="10px">
      <!-- Universidad select -->
      <mat-form-field fxFlex="0 1 calc((100% - (10px * 2)) / 3)" *ngIf="!this.formPart.isInvestigador">
        <mat-label>{{'csp.solicitud.solicitud-rrhh.universidad-select' | translate}}</mat-label>
        <sgi-select-empresa formControlName="universidadSelect">
        </sgi-select-empresa>
      </mat-form-field>

      <!-- Universidad text -->
      <mat-form-field fxFlex="0 1 calc((100% - (10px * 2)) / 3)">
        <mat-label>{{'csp.solicitud.solicitud-rrhh.universidad-text' | translate}}</mat-label>
        <input matInput type="text" placeholder="{{'csp.solicitud.solicitud-rrhh.universidad-text' | translate}}"
          formControlName="universidadText">
      </mat-form-field>
    </div>
  </form>

  <div fxLayout="column" class="separation-button">
    <h3>{{'csp.solicitud.solicitud-rrhh.area-anep' | translate}}</h3>
    <div class="mat-elevation-z4">
      <table mat-table [dataSource]="areasAnep" matSort matSortActive="nombre" matSortDirection="asc"
        matSortDisableClear *ngIf="areasAnep.data.length > 0">
        <!-- Niveles Column -->
        <ng-container matColumnDef="niveles">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>
            {{'csp.solicitud.solicitud-rrhh.area-anep-niveles' | translate}}
          </th>
          <td mat-cell *matCellDef="let data" matTooltip="{{data.nivelesTexto}}">
            {{data.nivelesTexto}}
          </td>
        </ng-container>

        <!-- Nivel seleccionado Column-->
        <ng-container matColumnDef="areaAnep">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>
            {{'csp.solicitud.solicitud-rrhh.area-anep' | translate}}
          </th>
          <td mat-cell *matCellDef="let data">
            {{data.nivelSeleccionado.nombre}}
          </td>
        </ng-container>
        <ng-container matColumnDef="acciones">
          <th mat-header-cell *matHeaderCellDef>{{'label.actions' | translate}}
          </th>
          <td mat-cell *matCellDef="let data">
            <ng-container *sgiHasAnyAuthorityForAnyUO="['CSP-SOL-E', 'CSP-SOL-INV-ER']">
              <button *ngIf="!!data && this.formPart.userCanEdit" mat-icon-button color="primary"
                matTooltip="{{'csp.solicitud.solicitud-rrhh.selecionar-area-anep' | translate}}" (click)="openModal()">
                <mat-icon>border_color</mat-icon>
              </button>
            </ng-container>
            <ng-container *sgiHasAnyAuthorityForAnyUO="['CSP-SOL-E', 'CSP-SOL-INV-ER']">
              <button *ngIf="!!data && this.formPart.userCanEdit" mat-icon-button color="warn"
                matTooltip="{{'btn.delete' | translate}}" (click)="deleteAreaAnep()">
                <mat-icon>highlight_off</mat-icon>
              </button>
            </ng-container>
          </td>
        </ng-container>
        <tr mat-header-row *matHeaderRowDef="columnsAreasAnep"></tr>
        <tr mat-row *matRowDef="let row; columns: columnsAreasAnep;"></tr>
      </table>
    </div>

    <button fxFlexAlign="start" color="three" *ngIf="areasAnep.data.length === 0 && this.formPart.userCanEdit"
      mat-raised-button (click)="openModal()">
      <mat-icon color="accent">add_circle</mat-icon>
      {{ 'btn.add.entity' | translate:msgParamAreaAnepEntity }}
    </button>
  </div>

  <sgi-info-message *ngIf="actionService.showSolicitudRRHHToValidateInfoMessage()"
    message="{{'info.csp.solicitud.datos-generales.solicitud-rrhh-validar' | translate}}">
  </sgi-info-message>

</sgi-fragment>