<sgi-fragment title="{{ 'label.datos-generales' | translate }}: {{ formGroup.controls.tipoRequerimiento?.value?.nombre
  }}">
  <section class="form-section">
    <form [formGroup]="formGroup">
      <div [fxLayout.xs]="fxLayoutProperties.xs" [fxLayout]="fxLayoutProperties.layout"
        [fxLayoutGap]="fxLayoutProperties.gap" ngClass.gt-xs="ml-10">
        <!-- Proyecto SGI -->
        <mat-form-field fxFlex="33%" fxFlex.sm="99%">
          <mat-label>{{'csp.ejecucion-economica.seguimiento-justificacion.requerimiento.proyecto-sgi' | translate}}
          </mat-label>
          <sgi-select-proyecto-proyecto-sge #proyectoProyectoSge formControlName="proyectoProyectoSge"
            [proyectoSgeRef]="formPart.proyectoSgeRef"
            (selectValuesChange)="selectFirstProyectoProyectoSgeIfOnlyOneOption($event)" required>
          </sgi-select-proyecto-proyecto-sge>
          <mat-error *ngIf="formGroup.controls.proyectoProyectoSge.errors?.required">
            {{'error.required.entity' | translate: msgParamProyectoSgiEntity}}
          </mat-error>
        </mat-form-field>

        <!-- Identificador justificación -->
        <mat-form-field fxFlex="33%" fxFlex.sm="99%">
          <mat-label>{{'csp.ejecucion-economica.seguimiento-justificacion.requerimiento.identificador-justificacion' |
            translate}}
          </mat-label>
          <sgi-select-proyecto-periodo-justificacion formControlName="proyectoPeriodoJustificacion"
            [proyectoId]="formGroup.controls.proyectoProyectoSge?.value?.proyecto?.id"
            [resetOnChange]="proyectoProyectoSge?.selectionChange">
          </sgi-select-proyecto-periodo-justificacion>
        </mat-form-field>
      </div>

      <div [fxLayout.xs]="fxLayoutProperties.xs" [fxLayout]="fxLayoutProperties.layout"
        [fxLayoutGap]="fxLayoutProperties.gap" ngClass.gt-xs="ml-10">
        <!-- Número requerimiento -->
        <mat-form-field fxFlex="33%" fxFlex.sm="99%">
          <mat-label>{{'csp.ejecucion-economica.seguimiento-justificacion.requerimiento.num-requerimiento' |
            translate}}</mat-label>
          <input matInput
            placeholder="{{'csp.ejecucion-economica.seguimiento-justificacion.requerimiento.num-requerimiento' | translate}}"
            type="number" formControlName="numRequerimiento">
        </mat-form-field>

        <!-- Tipo de requerimiento -->
        <mat-form-field fxFlex="33%" fxFlex.sm="99%">
          <mat-label>{{'csp.ejecucion-economica.seguimiento-justificacion.requerimiento.tipo-requerimiento' |
            translate}}
          </mat-label>
          <sgi-select-tipo-requerimiento formControlName="tipoRequerimiento" required>
          </sgi-select-tipo-requerimiento>
          <mat-error *ngIf="formGroup.controls.tipoRequerimiento.errors?.required">
            {{'error.required.entity' | translate: msgParamTipoRequerimientoEntity}}
          </mat-error>
        </mat-form-field>

        <!-- Requerimiento previo -->
        <mat-form-field fxFlex="32%" fxFlex.sm="99%">
          <mat-label>{{'csp.ejecucion-economica.seguimiento-justificacion.requerimiento.requerimiento-previo' |
            translate}}
          </mat-label>
          <sgi-select-requerimiento-justificacion formControlName="requerimientoPrevio"
            [proyectoId]="formGroup.controls.proyectoProyectoSge?.value?.proyecto?.id"
            [numRequerimiento]="formGroup.controls.numRequerimiento?.value" [excluded]="[formPart.getValue()]"
            [resetOnChange]="proyectoProyectoSge?.selectionChange">
          </sgi-select-requerimiento-justificacion>
        </mat-form-field>
      </div>

      <div [fxLayout.xs]="fxLayoutProperties.xs" [fxLayout]="fxLayoutProperties.layout"
        [fxLayoutGap]="fxLayoutProperties.gap" ngClass.gt-xs="ml-10">
        <!-- Fecha notificación -->
        <mat-form-field fxFlex="33%" fxFlex.sm="99%">
          <mat-label>{{'csp.ejecucion-economica.seguimiento-justificacion.requerimiento.fecha-notificacion'|
            translate}}</mat-label>
          <input matInput [matDatepicker]="pickerFechaNotificacion" formControlName="fechaNotificacion">
          <mat-datepicker-toggle class="fechaIcon" matSuffix [for]="pickerFechaNotificacion"></mat-datepicker-toggle>
          <mat-datepicker #pickerFechaNotificacion>
          </mat-datepicker>
        </mat-form-field>

        <!-- Fin plazo respuesta/alegación -->
        <mat-form-field fxFlex="33%" fxFlex.sm="99%">
          <mat-label>{{'csp.ejecucion-economica.seguimiento-justificacion.requerimiento.fin-plazo-respuesta-alegacion'
            | translate}}</mat-label>
          <input matInput formControlName="fechaFinAlegacion" [ngxMatDatetimePicker]="pickerFinPlazoAlegacion">
          <mat-datepicker-toggle matSuffix [for]="pickerFinPlazoAlegacion"></mat-datepicker-toggle>
          <ngx-mat-datetime-picker #pickerFinPlazoAlegacion showSeconds="true" [defaultTime]="[0,0,0]">
          </ngx-mat-datetime-picker>
        </mat-form-field>
      </div>

      <div [fxLayout.xs]="fxLayoutProperties.xs" [fxLayout]="fxLayoutProperties.layout"
        [fxLayoutGap]="fxLayoutProperties.gap" ngClass.gt-xs="ml-10">
        <!-- Importe total aceptado -->
        <mat-form-field fxFlex="33%" fxFlex.sm="99%">
          <mat-label>{{'csp.ejecucion-economica.seguimiento-justificacion.requerimiento.importe-total-aceptado' |
            translate}}</mat-label>
          <input matInput
            placeholder="{{'csp.ejecucion-economica.seguimiento-justificacion.requerimiento.importe-total-aceptado' | translate}}"
            type="text" formControlName="importeAceptado" sgiInputWithThousandSeparator>
        </mat-form-field>

        <!-- Importe aceptado: Costes directos -->
        <mat-form-field fxFlex="33%" fxFlex.sm="99%">
          <mat-label>{{'csp.ejecucion-economica.seguimiento-justificacion.requerimiento.importe-aceptado-cd' |
            translate}}</mat-label>
          <input matInput
            placeholder="{{'csp.ejecucion-economica.seguimiento-justificacion.requerimiento.importe-aceptado-cd' | translate}}"
            type="text" formControlName="importeAceptadoCd" sgiInputWithThousandSeparator>
        </mat-form-field>

        <!-- Importe aceptado: Costes indirectos -->
        <mat-form-field fxFlex="32%" fxFlex.sm="99%">
          <mat-label>{{'csp.ejecucion-economica.seguimiento-justificacion.requerimiento.importe-aceptado-ci' |
            translate}}</mat-label>
          <input matInput
            placeholder="{{'csp.ejecucion-economica.seguimiento-justificacion.requerimiento.importe-aceptado-ci' | translate}}"
            type="text" formControlName="importeAceptadoCi" sgiInputWithThousandSeparator>
        </mat-form-field>
      </div>

      <div [fxLayout.xs]="fxLayoutProperties.xs" [fxLayout]="fxLayoutProperties.layout"
        [fxLayoutGap]="fxLayoutProperties.gap" ngClass.gt-xs="ml-10">
        <!-- Importe total rechazado -->
        <mat-form-field fxFlex="33%" fxFlex.sm="99%">
          <mat-label>{{'csp.ejecucion-economica.seguimiento-justificacion.requerimiento.importe-total-rechazado' |
            translate}}</mat-label>
          <input matInput
            placeholder="{{'csp.ejecucion-economica.seguimiento-justificacion.requerimiento.importe-total-rechazado' | translate}}"
            type="text" formControlName="importeRechazado" sgiInputWithThousandSeparator>
        </mat-form-field>

        <!-- Importe rechazado: Costes directos -->
        <mat-form-field fxFlex="33%" fxFlex.sm="99%">
          <mat-label>{{'csp.ejecucion-economica.seguimiento-justificacion.requerimiento.importe-rechazado-cd' |
            translate}}</mat-label>
          <input matInput
            placeholder="{{'csp.ejecucion-economica.seguimiento-justificacion.requerimiento.importe-rechazado-cd' | translate}}"
            type="text" formControlName="importeRechazadoCd" sgiInputWithThousandSeparator>
        </mat-form-field>

        <!-- Importe rechazado: Costes indirectos -->
        <mat-form-field fxFlex="32%" fxFlex.sm="99%">
          <mat-label>{{'csp.ejecucion-economica.seguimiento-justificacion.requerimiento.importe-rechazado-ci' |
            translate}}</mat-label>
          <input matInput
            placeholder="{{'csp.ejecucion-economica.seguimiento-justificacion.requerimiento.importe-rechazado-ci' | translate}}"
            type="text" formControlName="importeRechazadoCi" sgiInputWithThousandSeparator>
        </mat-form-field>
      </div>

      <div [fxLayout.xs]="fxLayoutProperties.xs" [fxLayout]="fxLayoutProperties.layout"
        [fxLayoutGap]="fxLayoutProperties.gap" ngClass.gt-xs="ml-10">
        <!-- Importe total a reintegrar -->
        <mat-form-field fxFlex="33%" fxFlex.sm="99%">
          <mat-label>{{'csp.ejecucion-economica.seguimiento-justificacion.requerimiento.importe-total-reintegrar' |
            translate}}</mat-label>
          <input matInput
            placeholder="{{'csp.ejecucion-economica.seguimiento-justificacion.requerimiento.importe-total-reintegrar' | translate}}"
            type="text" formControlName="importeReintegrar" sgiInputWithThousandSeparator>
        </mat-form-field>

        <!-- Importe a reintegrar: Costes directos -->
        <mat-form-field fxFlex="33%" fxFlex.sm="99%">
          <mat-label>{{'csp.ejecucion-economica.seguimiento-justificacion.requerimiento.importe-reintegrar-cd' |
            translate}}</mat-label>
          <input matInput
            placeholder="{{'csp.ejecucion-economica.seguimiento-justificacion.requerimiento.importe-reintegrar-cd' | translate}}"
            type="text" formControlName="importeReintegrarCd" sgiInputWithThousandSeparator>
        </mat-form-field>

        <!-- Importe a reintegrar: Costes indirectos -->
        <mat-form-field fxFlex="32%" fxFlex.sm="99%">
          <mat-label>{{'csp.ejecucion-economica.seguimiento-justificacion.requerimiento.importe-reintegrar-ci' |
            translate}}</mat-label>
          <input matInput
            placeholder="{{'csp.ejecucion-economica.seguimiento-justificacion.requerimiento.importe-reintegrar-ci' | translate}}"
            type="text" formControlName="importeReintegrarCi" sgiInputWithThousandSeparator>
        </mat-form-field>
      </div>

      <div [fxLayout.xs]="fxLayoutProperties.xs" [fxLayout]="fxLayoutProperties.layout"
        [fxLayoutGap]="fxLayoutProperties.gap" ngClass.gt-xs="ml-10">
        <!-- Intereses a reintegrar -->
        <mat-form-field fxFlex="33%" fxFlex.sm="99%">
          <mat-label>{{'csp.ejecucion-economica.seguimiento-justificacion.requerimiento.intereses-reintegrar' |
            translate}}</mat-label>
          <input matInput
            placeholder="{{'csp.ejecucion-economica.seguimiento-justificacion.requerimiento.intereses-reintegrar' | translate}}"
            type="text" formControlName="interesesReintegrar" sgiInputWithThousandSeparator>
        </mat-form-field>
      </div>

      <div [fxLayout.xs]="fxLayoutProperties.xs" [fxLayout]="fxLayoutProperties.layout"
        [fxLayoutGap]="fxLayoutProperties.gap" ngClass.gt-xs="ml-10">
        <!-- Observaciones -->
        <mat-form-field fxFlex="98%" fxFlex.sm="99%">
          <mat-label>{{'csp.ejecucion-economica.seguimiento-justificacion.requerimiento.observaciones' | translate}}
          </mat-label>
          <textarea matInput formControlName="observaciones" type="text" id="observaciones"
            placeholder="{{'csp.ejecucion-economica.seguimiento-justificacion.requerimiento.observaciones' | translate}}">
          </textarea>
          <mat-error *ngIf="formGroup.controls.observaciones.errors?.maxlength">
            {{'error.maxlength.entity' | translate: msgParamObservaciones}}
          </mat-error>
        </mat-form-field>
      </div>

      <h2 class="divider">
        {{'csp.ejecucion-economica.seguimiento-justificacion.requerimiento.informe-cierre' | translate}}
      </h2>

      <div [fxLayout.xs]="fxLayoutProperties.xs" [fxLayout]="fxLayoutProperties.layout"
        [fxLayoutGap]="fxLayoutProperties.gap" ngClass.gt-xs="ml-10">
        <!-- Subvención justificada -->
        <mat-form-field fxFlex="24.25%" fxFlex.sm="99%">
          <mat-label>{{'csp.ejecucion-economica.seguimiento-justificacion.requerimiento.subvencion-justificada' |
            translate}}</mat-label>
          <input matInput
            placeholder="{{'csp.ejecucion-economica.seguimiento-justificacion.requerimiento.subvencion-justificada' | translate}}"
            type="text" formControlName="subvencionJustificada" sgiInputWithThousandSeparator>
        </mat-form-field>

        <!-- Defecto de la subvención -->
        <mat-form-field fxFlex="24.25%" fxFlex.sm="99%">
          <mat-label>{{'csp.ejecucion-economica.seguimiento-justificacion.requerimiento.defecto-subvencion' |
            translate}}</mat-label>
          <input matInput
            placeholder="{{'csp.ejecucion-economica.seguimiento-justificacion.requerimiento.defecto-subvencion' | translate}}"
            type="text" formControlName="defectoSubvencion" sgiInputWithThousandSeparator>
        </mat-form-field>

        <!-- Anticipo justificado -->
        <mat-form-field fxFlex="24.25%" fxFlex.sm="99%">
          <mat-label>{{'csp.ejecucion-economica.seguimiento-justificacion.requerimiento.anticipo-justificado' |
            translate}}</mat-label>
          <input matInput
            placeholder="{{'csp.ejecucion-economica.seguimiento-justificacion.requerimiento.anticipo-justificado' | translate}}"
            type="text" formControlName="anticipoJustificado" sgiInputWithThousandSeparator>
        </mat-form-field>

        <!-- Defecto del anticipo -->
        <mat-form-field fxFlex="24.25%" fxFlex.sm="99%">
          <mat-label>{{'csp.ejecucion-economica.seguimiento-justificacion.requerimiento.defecto-anticipo' |
            translate}}</mat-label>
          <input matInput
            placeholder="{{'csp.ejecucion-economica.seguimiento-justificacion.requerimiento.defecto-anticipo' | translate}}"
            type="text" formControlName="defectoAnticipo" sgiInputWithThousandSeparator>
        </mat-form-field>
      </div>

      <h2 class="divider">
        {{'csp.ejecucion-economica.seguimiento-justificacion.requerimiento.resolucion-recurso' | translate }}
      </h2>

      <div [fxLayout.xs]="fxLayoutProperties.xs" [fxLayout]="fxLayoutProperties.layout"
        [fxLayoutGap]="fxLayoutProperties.gap" ngClass.gt-xs="ml-10">
        <!-- Recurso estimado -->
        <mat-form-field fxFlex="33%" fxFlex.sm="99%">
          <mat-label>{{'csp.ejecucion-economica.seguimiento-justificacion.requerimiento.recurso-estimado' | translate}}
          </mat-label>
          <mat-select matNativeControl formControlName="recursoEstimado">
            <mat-option [value]="true">{{'label.si' | translate}}</mat-option>
            <mat-option [value]="false">{{'label.no' | translate}}</mat-option>
          </mat-select>
        </mat-form-field>
      </div>
    </form>
  </section>

  <section class="table-section">
    <h2 class="divider">
      {{'csp.ejecucion-economica.seguimiento-justificacion.requerimiento.incidencias-documentacion' | translate }}
    </h2>
    <div class="mat-elevation-z4">
      <table class="table-incidencia-documentacion" mat-table [dataSource]="dataSource" matSort matSortActive="id"
        matSortDirection="asc" matSortDisableClear>

        <!-- Documento justificación Column -->
        <ng-container matColumnDef="nombreDocumento">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>
            {{'csp.ejecucion-economica.seguimiento-justificacion.requerimiento.incidencia-documento.documento' |
            translate}} </th>
          <td mat-cell *matCellDef="let wrapper">
            {{wrapper.value.nombreDocumento}}
          </td>
        </ng-container>

        <!-- Incidencia/Motivo rechazo Column -->
        <ng-container matColumnDef="incidencia">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>
            {{'csp.ejecucion-economica.seguimiento-justificacion.requerimiento.incidencia-documento.incidencia' |
            translate}}
          </th>
          <td mat-cell *matCellDef="let wrapper"> {{wrapper.value.incidencia}} </td>
        </ng-container>

        <!-- Acciones  Column -->
        <ng-container matColumnDef="acciones">
          <th mat-header-cell *matHeaderCellDef> {{'label.actions' | translate}} </th>
          <td mat-cell *matCellDef="let wrapper; let i = index">
            <ng-container>
              <div fxLayout="row">
                <button color="primary" *sgiHasAuthorityForAnyUO="'CSP-SJUS-E'" mat-icon-button
                  matTooltip="{{'btn.edit' | translate}}" (click)="openModal(wrapper, i)">
                  <mat-icon>border_color</mat-icon>
                </button>
                <button color="warn" *sgiHasAuthorityForAnyUO="'CSP-SJUS-E'" mat-icon-button
                  matTooltip="{{'btn.delete' | translate}}" (click)="deleteIncidenciaDocumentacion(wrapper)">
                  <mat-icon>highlight_off</mat-icon>
                </button>
              </div>
            </ng-container>
          </td>
        </ng-container>
        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>

      </table>

      <mat-paginator [pageSizeOptions]="elementosPagina" showFirstLastButtons>
      </mat-paginator>
    </div>
    <div class="separation-button" *sgiHasAuthorityForAnyUO="'CSP-SJUS-E'">
      <!-- Botón añadir Incidencia documentación -->
      <button color="three" mat-button mat-raised-button (click)="openModal()">
        <mat-icon color="accent">add_circle</mat-icon>
        {{ 'btn.add.entity' | translate: msgParamIncidenciaDocumentacionEntity }}
      </button>
    </div>
  </section>
</sgi-fragment>