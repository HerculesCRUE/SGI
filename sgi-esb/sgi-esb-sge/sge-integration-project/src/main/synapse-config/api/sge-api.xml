<?xml version="1.0" encoding="UTF-8"?>
<api context="/sge" name="sge-api" publishSwagger="/_system/governance/swagger_files/sge-swagger.yaml" xmlns="http://ws.apache.org/ns/synapse">

  <!-- codigos economicos gastos -->
  <resource methods="GET" url-mapping="/codigos-economicos-gastos">
    <inSequence>
      <call-template target="sgi-auth-sequence-template">
        <with-param name="requiredAuthorities" value="" />
      </call-template>
      <sequence key="sge-add-x-api-key-sequence" />
      <sequence key="sge-remove-authorization-header-sequence" />
      <send>
        <endpoint key="sge-endpoint" />
      </send>
    </inSequence>
    <outSequence>
      <respond />
    </outSequence>
    <faultSequence>
      <sequence key="error-handling-sequence" />
    </faultSequence>
  </resource>

  <resource methods="GET" uri-template="/codigos-economicos-gastos/{id}">
    <inSequence>
      <call-template target="sgi-auth-sequence-template">
        <with-param name="requiredAuthorities" value="" />
      </call-template>
      <sequence key="sge-add-x-api-key-sequence" />
      <sequence key="sge-remove-authorization-header-sequence" />
      <send>
        <endpoint key="sge-endpoint" />
      </send>
    </inSequence>
    <outSequence>
      <respond />
    </outSequence>
    <faultSequence>
      <sequence key="error-handling-sequence" />
    </faultSequence>
  </resource>

  <!-- codigos economicos ingresos -->
  <resource methods="GET" url-mapping="/codigos-economicos-ingresos">
    <inSequence>
      <call-template target="sgi-auth-sequence-template">
        <with-param name="requiredAuthorities" value="" />
      </call-template>
      <sequence key="sge-add-x-api-key-sequence" />
      <sequence key="sge-remove-authorization-header-sequence" />
      <send>
        <endpoint key="sge-endpoint" />
      </send>
    </inSequence>
    <outSequence>
      <respond />
    </outSequence>
    <faultSequence>
      <sequence key="error-handling-sequence" />
    </faultSequence>
  </resource>

  <resource methods="GET" uri-template="/codigos-economicos-ingresos/{id}">
    <inSequence>
      <call-template target="sgi-auth-sequence-template">
        <with-param name="requiredAuthorities" value="" />
      </call-template>
      <sequence key="sge-add-x-api-key-sequence" />
      <sequence key="sge-remove-authorization-header-sequence" />
      <send>
        <endpoint key="sge-endpoint" />
      </send>
    </inSequence>
    <outSequence>
      <respond />
    </outSequence>
    <faultSequence>
      <sequence key="error-handling-sequence" />
    </faultSequence>
  </resource>

  <!-- documentos -->
  <resource methods="GET" uri-template="/documentos/{id}">
    <inSequence>
      <call-template target="sgi-auth-sequence-template">
        <with-param name="requiredAuthorities" value="" />
      </call-template>
      <sequence key="sge-add-x-api-key-sequence" />
      <sequence key="sge-remove-authorization-header-sequence" />
      <send>
        <endpoint key="sge-endpoint" />
      </send>
    </inSequence>
    <outSequence>
      <respond />
    </outSequence>
    <faultSequence>
      <sequence key="error-handling-sequence" />
    </faultSequence>
  </resource>

  <resource methods="GET" uri-template="/documentos/{id}/archivo">
    <inSequence>
      <call-template target="sgi-auth-sequence-template">
        <with-param name="requiredAuthorities" value="" />
      </call-template>
      <sequence key="sge-add-x-api-key-sequence" />
      <sequence key="sge-remove-authorization-header-sequence" />
      <send>
        <endpoint key="sge-endpoint" />
      </send>
    </inSequence>
    <outSequence>
      <respond />
    </outSequence>
    <faultSequence>
      <sequence key="error-handling-sequence" />
    </faultSequence>
  </resource>

  <!-- ejecucion economica -->
  <resource methods="GET" url-mapping="/ejecucion-economica">
    <inSequence>
      <call-template target="sgi-auth-sequence-template">
        <with-param name="requiredAuthorities" value="" />
      </call-template>
      <sequence key="sge-add-x-api-key-sequence" />
      <sequence key="sge-remove-authorization-header-sequence" />
      <send>
        <endpoint key="sge-endpoint" />
      </send>
    </inSequence>
    <outSequence>
      <respond />
    </outSequence>
    <faultSequence>
      <sequence key="error-handling-sequence" />
    </faultSequence>
  </resource>

  <resource methods="GET" url-mapping="/ejecucion-economica/columnas">
    <inSequence>
      <call-template target="sgi-auth-sequence-template">
        <with-param name="requiredAuthorities" value="" />
      </call-template>
      <sequence key="sge-add-x-api-key-sequence" />
      <sequence key="sge-remove-authorization-header-sequence" />
      <send>
        <endpoint key="sge-endpoint" />
      </send>
    </inSequence>
    <outSequence>
      <respond />
    </outSequence>
    <faultSequence>
      <sequence key="error-handling-sequence" />
    </faultSequence>
  </resource>
  
  <resource methods="GET" uri-template="/ejecucion-economica/{id}">
    <inSequence>
      <call-template target="sgi-auth-sequence-template">
        <with-param name="requiredAuthorities" value="" />
      </call-template>
      <sequence key="sge-add-x-api-key-sequence" />
      <sequence key="sge-remove-authorization-header-sequence" />
      <send>
        <endpoint key="sge-endpoint" />
      </send>
    </inSequence>
    <outSequence>
      <respond />
    </outSequence>
    <faultSequence>
      <sequence key="error-handling-sequence" />
    </faultSequence>
  </resource>

  <!-- gastos -->
  <resource methods="GET" url-mapping="/gastos">
    <inSequence>
      <call-template target="sgi-auth-sequence-template">
        <with-param name="requiredAuthorities" value="" />
      </call-template>
      <sequence key="sge-add-x-api-key-sequence" />
      <sequence key="sge-remove-authorization-header-sequence" />
      <send>
        <endpoint key="sge-endpoint" />
      </send>
    </inSequence>
    <outSequence>
      <respond />
    </outSequence>
    <faultSequence>
      <sequence key="error-handling-sequence" />
    </faultSequence>
  </resource>

  <resource methods="GET" url-mapping="/gastos/columnas">
    <inSequence>
      <call-template target="sgi-auth-sequence-template">
        <with-param name="requiredAuthorities" value="" />
      </call-template>
      <sequence key="sge-add-x-api-key-sequence" />
      <sequence key="sge-remove-authorization-header-sequence" />
      <send>
        <endpoint key="sge-endpoint" />
      </send>
    </inSequence>
    <outSequence>
      <respond />
    </outSequence>
    <faultSequence>
      <sequence key="error-handling-sequence" />
    </faultSequence>
  </resource>

  <resource methods="GET" uri-template="/gastos/{id}">
    <inSequence>
      <call-template target="sgi-auth-sequence-template">
        <with-param name="requiredAuthorities" value="" />
      </call-template>
      <sequence key="sge-add-x-api-key-sequence" />
      <sequence key="sge-remove-authorization-header-sequence" />
      <send>
        <endpoint key="sge-endpoint" />
      </send>
    </inSequence>
    <outSequence>
      <respond />
    </outSequence>
    <faultSequence>
      <sequence key="error-handling-sequence" />
    </faultSequence>
  </resource>

  <resource methods="PATCH" uri-template="/gastos/{id}/validar">
    <inSequence>
      <call-template target="sgi-auth-sequence-template">
        <with-param name="requiredAuthorities" value="" />
      </call-template>
      <sequence key="sge-add-x-api-key-sequence" />
      <sequence key="sge-remove-authorization-header-sequence" />
      <send>
        <endpoint key="sge-endpoint" />
      </send>
    </inSequence>
    <outSequence>
      <respond />
    </outSequence>
    <faultSequence>
      <sequence key="error-handling-sequence" />
    </faultSequence>
  </resource>

  <resource methods="PATCH" uri-template="/gastos/{id}/rechazar">
    <inSequence>
      <call-template target="sgi-auth-sequence-template">
        <with-param name="requiredAuthorities" value="" />
      </call-template>
      <sequence key="sge-add-x-api-key-sequence" />
      <sequence key="sge-remove-authorization-header-sequence" />
      <send>
        <endpoint key="sge-endpoint" />
      </send>
    </inSequence>
    <outSequence>
      <respond />
    </outSequence>
    <faultSequence>
      <sequence key="error-handling-sequence" />
    </faultSequence>
  </resource>

  <!-- proyectos -->
  <resource methods="GET" url-mapping="/proyectos">
    <inSequence>
      <call-template target="sgi-auth-sequence-template">
        <with-param name="requiredAuthorities" value="" />
      </call-template>
      <sequence key="sge-add-x-api-key-sequence" />
      <sequence key="sge-remove-authorization-header-sequence" />
      <send>
        <endpoint key="sge-endpoint" />
      </send>
    </inSequence>
    <outSequence>
      <respond />
    </outSequence>
    <faultSequence>
      <sequence key="error-handling-sequence" />
    </faultSequence>
  </resource>

  <resource methods="GET" uri-template="/proyectos/{id}">
    <inSequence>
      <call-template target="sgi-auth-sequence-template">
        <with-param name="requiredAuthorities" value="" />
      </call-template>
      <sequence key="sge-add-x-api-key-sequence" />
      <sequence key="sge-remove-authorization-header-sequence" />
      <send>
        <endpoint key="sge-endpoint" />
      </send>
    </inSequence>
    <outSequence>
      <respond />
    </outSequence>
    <faultSequence>
      <sequence key="error-handling-sequence" />
    </faultSequence>
  </resource>

  <resource methods="GET" url-mapping="/proyectos/formly/create">
    <inSequence>
      <call-template target="sgi-auth-sequence-template">
        <with-param name="requiredAuthorities" value="" />
      </call-template>
      
      <sequence key="sge-remove-authorization-header-sequence" />

      <payloadFactory media-type="json">
        <format>
[
  {
    "wrappers": [
      "global"
    ],
    "templateOptions": {
      "styles": "{ \"width\": \"700px\" }"
    },
    "fieldGroup": [
      {
        "wrappers": [
          "mat-card-group"
        ],
        "templateOptions": {
          "label": ""
        },
        "fieldGroup": [
          {
            "fieldGroup": [
              {
                "key": "proyectoSgiId",
                "type": "input",
                "templateOptions": {
                  "label": "Identificador proyecto SGI",
                  "disabled": true
                },
                "expressionProperties": {
                  "model.proyectoSgiId": "formState.mainModel.proyecto.id"
                }
              },
              {
                "key": "titulo",
                "type": "input",
                "templateOptions": {
                  "label": "Título proyecto",
                  "required": true,
                  "disabled": true
                },
                "expressionProperties": {
                  "model.titulo": "formState.mainModel.proyecto.titulo"
                }
              },
              {
                "fieldGroupClassName": "row-formly",
                "fieldGroup": [
                  {
                    "key": "fechaInicio",
                    "type": "dateTimePicker",
                    "className": "flex-1",
                    "templateOptions": {
                      "label": "Fecha inicio",
                      "placeholder": "Introduce fecha inicio",
                      "disabled": true
                    },
                    "expressionProperties": {
                      "model.fechaInicio": "formState.mainModel.proyecto.fechaInicio"
                    }
                  },
                  {
                    "key": "fechaFin",
                    "type": "dateTimePicker",
                    "className": "flex-1",
                    "templateOptions": {
                      "label": "Fecha fin",
                      "placeholder": "Introduce fecha fin",
                      "disabled": true
                    },
                    "expressionProperties": {
                      "model.fechaFin": "formState.mainModel.proyecto.fechaFin"
                    }
                  }
                ]
              },
              {
                "key": "numeroDocumentoResponsable",
                "type": "input",
                "templateOptions": {
                  "label": "Identificador número de documento del responsable",
                  "disabled": true
                },
                "expressionProperties": {
                  "model.numeroDocumentoResponsable": "formState.mainModel.numeroDocumentoResponsable"
                }
              },
              {
                "fieldGroupClassName": "row-formly",
                "hideExpression": "formState.isGrupo === true",
                "fieldGroup": [
                  {
                    "key": "modeloEjecucion",
                    "type": "select-object",
                    "className": "flex-1",
                    "templateOptions": {
                      "label": "Modelo de ejecución",
                      "required": true,
                      "disabled": true,
                      "modelKeyCompareProp": "id",
                      "modelKeyLabelProp": "nombre",
                      "modelKeyValueProp": "modeloEjecucion"
                    },
                    "expressionProperties": {
                      "model.modeloEjecucion": "formState.mainModel.proyecto.modeloEjecucion"
                    }
                  },
                  {
                    "key": "tipoFinalidad",
                    "type": "select-object",
                    "className": "flex-1",
                    "templateOptions": {
                      "label": "Tipo de finalidad",
                      "required": true,
                      "disabled": true,
                      "modelKeyCompareProp": "id",
                      "modelKeyLabelProp": "nombre",
                      "modelKeyValueProp": "tipoFinalidad"
                    },
                    "expressionProperties": {
                      "model.tipoFinalidad": "formState.mainModel.proyecto.finalidad"
                    }
                  }
                ]
              },
              {
                "fieldGroupClassName": "row-formly",
                "fieldGroup": [
                  {
                    "key": "importeTotalGastos",
                    "type": "input",
                    "className": "flex-1",
                    "templateOptions": {
                      "label": "Importe total previsto de gastos",
                      "type": "number",
                      "min": 0
                    },
                    "expressionProperties": {
                      "model.importeTotalGastos": "formState.mainModel.importeTotalGastos"
                    }
                  },
                  {
                    "key": "importeTotalIngresos",
                    "type": "input",
                    "className": "flex-1",
                    "templateOptions": {
                      "label": "Importe total previsto de ingresos",
                      "type": "number",
                      "min": 0
                    },
                    "expressionProperties": {
                      "model.importeTotalIngresos": "formState.mainModel.importeTotalIngresos"
                    }
                  }
                ]
              },
              {
                "fieldGroupClassName": "row-formly",
                "fieldGroup": [
                  {
                    "key": "porIva",
                    "type": "input",
                    "className": "flex-1",
                    "templateOptions": {
                      "label": "% IVA",
                      "type": "number",
                      "min": 0,
                      "disabled": true
                    },
                    "expressionProperties": {
                      "model.porIva": "formState.mainModel.porIva"
                    }
                  },
                  {
                    "key": "causaExencion",
                    "type": "input",
                    "className": "flex-1",
                    "templateOptions": {
                      "label": "Causa exención",
                      "disabled": true
                    },
                    "expressionProperties": {
                      "model.causaExencion": "formState.mainModel.causaExencionDesc"
                    }
                  }
                ]
              }
            ]
          }
        ]
      }
    ]
  }
]
        </format>
        <args />
      </payloadFactory>
      <respond />
    </inSequence>
    <outSequence>
      <respond />
    </outSequence>
    <faultSequence>
      <sequence key="error-handling-sequence" />
    </faultSequence>
  </resource>

  <resource methods="GET" url-mapping="/proyectos/formly/update">
    <inSequence>
      <call-template target="sgi-auth-sequence-template">
        <with-param name="requiredAuthorities" value="" />
      </call-template>

      <sequence key="sge-remove-authorization-header-sequence" />

      <payloadFactory media-type="json">
        <format>
[
  {
    "wrappers": [
      "global"
    ],
    "templateOptions": {
      "styles": "{ \"width\": \"700px\" }"
    },
    "fieldGroup": [
      {
        "wrappers": [
          "mat-card-group"
        ],
        "templateOptions": {
          "label": ""
        },
        "fieldGroup": [
          {
            "fieldGroup": [
              {
                "fieldGroupClassName": "row-formly",
                "fieldGroup": [
                  {
                    "key": "proyectoSgiId",
                    "type": "input",
                    "className": "flex-1",
                    "templateOptions": {
                      "label": "Identificador proyecto SGI",
                      "disabled": true
                    },
                    "expressionProperties": {
                      "model.proyectoSgiId": "formState.mainModel.proyecto.id"
                    }
                  },
                  {
                    "key": "proyectoSgeId",
                    "type": "input",
                    "className": "flex-1",
                    "templateOptions": {
                      "label": "Identificador proyecto SGE",
                      "disabled": true
                    },
                    "expressionProperties": {
                      "model.proyectoSgeId": "formState.mainModel.sgeId"
                    }
                  }
                ]
              },
              {
                "key": "titulo",
                "type": "input",
                "templateOptions": {
                  "label": "Título proyecto",
                  "required": true,
                  "disabled": true
                },
                "expressionProperties": {
                  "model.titulo": "formState.mainModel.proyecto.titulo"
                }
              },
              {
                "fieldGroupClassName": "row-formly",
                "fieldGroup": [
                  {
                    "key": "fechaInicio",
                    "type": "dateTimePicker",
                    "className": "flex-1",
                    "templateOptions": {
                      "label": "Fecha inicio",
                      "placeholder": "Introduce fecha inicio",
                      "disabled": true
                    },
                    "expressionProperties": {
                      "model.fechaInicio": "formState.mainModel.proyecto.fechaInicio"
                    }
                  },
                  {
                    "key": "fechaFin",
                    "type": "dateTimePicker",
                    "className": "flex-1",
                    "templateOptions": {
                      "label": "Fecha fin",
                      "placeholder": "Introduce fecha fin",
                      "disabled": true
                    },
                    "expressionProperties": {
                      "model.fechaFin": "formState.mainModel.proyecto.fechaFin"
                    }
                  }
                ]
              },
              {
                "key": "numeroDocumentoResponsable",
                "type": "input",
                "templateOptions": {
                  "label": "Identificador número de documento del responsable",
                  "disabled": true
                },
                "expressionProperties": {
                  "model.numeroDocumentoResponsable": "formState.mainModel.numeroDocumentoResponsable"
                }
              },
              {
                "fieldGroupClassName": "row-formly",
                "hideExpression": "formState.isGrupo === true",
                "fieldGroup": [
                  {
                    "key": "modeloEjecucion",
                    "type": "select-object",
                    "className": "flex-1",
                    "templateOptions": {
                      "label": "Modelo de ejecución",
                      "required": true,
                      "disabled": true,
                      "modelKeyCompareProp": "id",
                      "modelKeyLabelProp": "nombre",
                      "modelKeyValueProp": "modeloEjecucion"
                    },
                    "expressionProperties": {
                      "model.modeloEjecucion": "formState.mainModel.proyecto.modeloEjecucion"
                    }
                  },
                  {
                    "key": "tipoFinalidad",
                    "type": "select-object",
                    "className": "flex-1",
                    "templateOptions": {
                      "label": "Tipo de finalidad",
                      "required": true,
                      "disabled": true,
                      "modelKeyCompareProp": "id",
                      "modelKeyLabelProp": "nombre",
                      "modelKeyValueProp": "tipoFinalidad"
                    },
                    "expressionProperties": {
                      "model.tipoFinalidad": "formState.mainModel.proyecto.finalidad"
                    }
                  }
                ]
              },
              {
                "fieldGroupClassName": "row-formly",
                "fieldGroup": [
                  {
                    "key": "importeTotalGastos",
                    "type": "input",
                    "className": "flex-1",
                    "templateOptions": {
                      "label": "Importe total previsto de gastos",
                      "type": "number",
                      "min": 0
                    },
                    "expressionProperties": {
                      "model.importeTotalGastos": "formState.mainModel.importeTotalGastos"
                    }
                  },
                  {
                    "key": "importeTotalIngresos",
                    "type": "input",
                    "className": "flex-1",
                    "templateOptions": {
                      "label": "Importe total previsto de ingresos",
                      "type": "number",
                      "min": 0
                    },
                    "expressionProperties": {
                      "model.importeTotalIngresos": "formState.mainModel.importeTotalIngresos"
                    }
                  }
                ]
              },
              {
                "fieldGroupClassName": "row-formly",
                "fieldGroup": [
                  {
                    "key": "porIva",
                    "type": "input",
                    "className": "flex-1",
                    "templateOptions": {
                      "label": "% IVA",
                      "type": "number",
                      "min": 0,
                      "disabled": true
                    },
                    "expressionProperties": {
                      "model.porIva": "formState.mainModel.porIva"
                    }
                  },
                  {
                    "key": "causaExencion",
                    "type": "input",
                    "className": "flex-1",
                    "templateOptions": {
                      "label": "Causa exención",
                      "disabled": true
                    },
                    "expressionProperties": {
                      "model.causaExencion": "formState.mainModel.causaExencionDesc"
                    }
                  }
                ]
              }
            ]
          }
        ]
      }
    ]
  }
]
        </format>
        <args />
      </payloadFactory>
      <respond />
    </inSequence>
    <outSequence>
      <respond />
    </outSequence>
    <faultSequence>
      <sequence key="error-handling-sequence" />
    </faultSequence>
  </resource>

  <resource methods="GET" url-mapping="/proyectos/formly/view">
    <inSequence>
      <call-template target="sgi-auth-sequence-template">
        <with-param name="requiredAuthorities" value="" />
      </call-template>
      
      <sequence key="sge-remove-authorization-header-sequence" />

      <payloadFactory media-type="json">
        <format>
[
  {
    "wrappers": [
      "global"
    ],
    "templateOptions": {
      "styles": "{ \"width\": \"700px\" }"
    },
    "fieldGroup": [
      {
        "wrappers": [
          "mat-card-group"
        ],
        "templateOptions": {
          "label": ""
        },
        "fieldGroup": [
          {
            "fieldGroup": [
              {
                "fieldGroupClassName": "row-formly",
                "fieldGroup": [
                  {
                    "key": "proyectoSgeProyectoSgiId",
                    "type": "input",
                    "className": "flex-1-50",
                    "templateOptions": {
                      "disabled": true,
                      "label": "Identificador proyecto SGI",
                      "required": true
                    },
                    "expressionProperties": {
                      "model.proyectoSgeProyectoSgiId": "formState.mainModel.proyectoSge.proyectoSGIId"
                    }
                  }
                ]
              },
              {
                "key": "proyectoSgeTitulo",
                "type": "input",
                "templateOptions": {
                  "disabled": true,
                  "label": "Título proyecto",
                  "required": true
                },
                "expressionProperties": {
                  "model.proyectoSgeTitulo": "formState.mainModel.proyectoSge.titulo"
                }
              },
              {
                "fieldGroupClassName": "row-formly",
                "fieldGroup": [
                  {
                    "key": "proyectoSgeFechaInicio",
                    "type": "datepicker",
                    "className": "flex-1",
                    "templateOptions": {
                      "disabled": true,
                      "label": "Fecha inicio",
                      "placeholder": "Introduce fecha inicio",
                      "required": true
                    },
                    "expressionProperties": {
                      "model.proyectoSgeFechaInicio": "formState.mainModel.proyectoSge.fechaInicio"
                    }
                  },
                  {
                    "key": "proyectoSgeFechaFin",
                    "type": "datepicker",
                    "className": "flex-1",
                    "templateOptions": {
                      "disabled": true,
                      "label": "Fecha fin",
                      "placeholder": "Introduce fecha fin",
                      "required": true
                    },
                    "expressionProperties": {
                      "model.proyectoSgeFechaFin": "formState.mainModel.proyectoSge.fechaFin"
                    }
                  }
                ]
              },
              {
                "fieldGroupClassName": "row-formly",
                "fieldGroup": [
                  {
                    "key": "proyectoSgeSectorIva",
                    "type": "select",
                    "className": "flex-1-50",
                    "templateOptions": {
                      "disabled": true,
                      "label": "Sector IVA",
                      "labelProp": "label",
                      "options": [
                        {
                          "value": true,
                          "label": "Sí"
                        },
                        {
                          "value": false,
                          "label": "No"
                        }
                      ],
                      "required": true,
                      "valueProp": "value"
                    },
                    "expressionProperties": {
                      "model.proyectoSgeSectorIva": "formState.mainModel.proyectoSge.sectorIva"
                    }
                  }
                ]
              }
            ]
          }
        ]
      }
    ]
  }
]
        </format>
        <args>
          <arg expression="get-property('tiposAyuda')" literal="true"/>
        </args>
      </payloadFactory>
      <respond />
    </inSequence>
    <outSequence>
      <respond />
    </outSequence>
    <faultSequence>
      <sequence key="error-handling-sequence" />
    </faultSequence>
  </resource>

  <resource methods="POST" url-mapping="/proyectos/formly">
    <inSequence>
      <call-template target="sgi-auth-sequence-template">
        <with-param name="requiredAuthorities" value="" />
      </call-template>
      <sequence key="sge-add-x-api-key-sequence" />
      <sequence key="sge-remove-authorization-header-sequence" />
      <send>
        <endpoint key="sge-endpoint" />
      </send>
    </inSequence>
    <outSequence>
      <respond />
    </outSequence>
    <faultSequence>
      <sequence key="error-handling-sequence" />
    </faultSequence>
  </resource>

  <resource methods="GET" uri-template="/proyectos/formly/{id}">
    <inSequence>
      <call-template target="sgi-auth-sequence-template">
        <with-param name="requiredAuthorities" value="" />
      </call-template>

      <property name="url" expression="get-property('axis2','REST_URL_POSTFIX')" />
      <rewrite inProperty="url" outProperty="url">
        <rewriterule>
          <action type="replace" regex="/proyectos/formly" value="/proyectos" fragment="path" />
        </rewriterule>
      </rewrite>
      <property name="REST_URL_POSTFIX" scope="axis2" expression="get-property('url')" />

      <sequence key="sge-add-x-api-key-sequence" />
      <sequence key="sge-remove-authorization-header-sequence" />

      <send>
        <endpoint key="sge-endpoint" />
      </send>
    </inSequence>
    <outSequence>
      <respond />
    </outSequence>
    <faultSequence>
      <sequence key="error-handling-sequence" />
    </faultSequence>
  </resource>

  <resource methods="PUT" uri-template="/proyectos/formly/{id}">
    <inSequence>
      <call-template target="sgi-auth-sequence-template">
        <with-param name="requiredAuthorities" value="" />
      </call-template>

      <log level="custom">
        <property name="SGI_ESB_CONTEXT" expression="get-property('env', 'SGI_ESB_CONTEXT')" />
      </log>

      <switch source="get-property('env', 'SGI_ESB_CONTEXT')">
        <case regex="dev">
          <log level="custom">
            <property name="response" value="dev mock" />
          </log>
          <property name="NO_ENTITY_BODY" value="true" scope="axis2" type="BOOLEAN" />
          <respond />
        </case>
        <default>
          <sequence key="sge-add-x-api-key-sequence" />
          <sequence key="sge-remove-authorization-header-sequence" />
          <send>
            <endpoint key="sge-endpoint" />
          </send>
        </default>
      </switch>

    </inSequence>
    <outSequence>
      <respond />
    </outSequence>
    <faultSequence>
      <sequence key="error-handling-sequence" />
    </faultSequence>
  </resource>

  <!-- proyectos anualidades -->
  <resource methods="POST" url-mapping="/proyectos/anualidades">
    <inSequence>
      <call-template target="sgi-auth-sequence-template">
        <with-param name="requiredAuthorities" value="" />
      </call-template>
      <sequence key="sge-add-x-api-key-sequence" />
      <sequence key="sge-remove-authorization-header-sequence" />
      <send>
        <endpoint key="sge-endpoint" />
      </send>
    </inSequence>
    <outSequence>
      <respond />
    </outSequence>
    <faultSequence>
      <sequence key="error-handling-sequence" />
    </faultSequence>
  </resource>

  <!-- facturas -->
  <resource methods="GET" url-mapping="/facturas-emitidas">
    <inSequence>
      <call-template target="sgi-auth-sequence-template">
        <with-param name="requiredAuthorities" value="" />
      </call-template>
      <sequence key="sge-add-x-api-key-sequence" />
      <sequence key="sge-remove-authorization-header-sequence" />
      <send>
        <endpoint key="sge-endpoint" />
      </send>
    </inSequence>
    <outSequence>
      <respond />
    </outSequence>
    <faultSequence>
      <sequence key="error-handling-sequence" />
    </faultSequence>
  </resource>

  <resource methods="GET" url-mapping="/facturas-emitidas/columnas">
    <inSequence>
      <call-template target="sgi-auth-sequence-template">
        <with-param name="requiredAuthorities" value="" />
      </call-template>
      <sequence key="sge-add-x-api-key-sequence" />
      <sequence key="sge-remove-authorization-header-sequence" />
      <send>
        <endpoint key="sge-endpoint" />
      </send>
    </inSequence>
    <outSequence>
      <respond />
    </outSequence>
    <faultSequence>
      <sequence key="error-handling-sequence" />
    </faultSequence>
  </resource>

  <resource methods="GET" uri-template="/facturas-emitidas/{id}">
    <inSequence>
      <call-template target="sgi-auth-sequence-template">
        <with-param name="requiredAuthorities" value="" />
      </call-template>
      <sequence key="sge-add-x-api-key-sequence" />
      <sequence key="sge-remove-authorization-header-sequence" />
      <send>
        <endpoint key="sge-endpoint" />
      </send>
    </inSequence>
    <outSequence>
      <respond />
    </outSequence>
    <faultSequence>
      <sequence key="error-handling-sequence" />
    </faultSequence>
  </resource>

  <resource methods="GET" url-mapping="/facturas-previstas-emitidas">
    <inSequence>
      <call-template target="sgi-auth-sequence-template">
        <with-param name="requiredAuthorities" value="" />
      </call-template>
      <sequence key="sge-add-x-api-key-sequence" />
      <sequence key="sge-remove-authorization-header-sequence" />
      <send>
        <endpoint key="sge-endpoint" />
      </send>
    </inSequence>
    <outSequence>
      <respond />
    </outSequence>
    <faultSequence>
      <sequence key="error-handling-sequence" />
    </faultSequence>
  </resource>

  <resource methods="GET" url-mapping="/facturas-previstas">
    <inSequence>
      <send>
        <endpoint key="sgicsp-endpoint" />
      </send>
    </inSequence>
    <outSequence>
      <respond />
    </outSequence>
    <faultSequence>
      <sequence key="error-handling-sequence" />
    </faultSequence>
  </resource>

  <!-- periodos amortizacion -->
  <resource methods="POST" url-mapping="/periodos-amortizacion">
    <inSequence>
      <call-template target="sgi-auth-sequence-template">
        <with-param name="requiredAuthorities" value="" />
      </call-template>
      <sequence key="sge-add-x-api-key-sequence" />
      <sequence key="sge-remove-authorization-header-sequence" />
      <send>
        <endpoint key="sge-endpoint" />
      </send>
    </inSequence>
    <outSequence>
      <respond />
    </outSequence>
    <faultSequence>
      <sequence key="error-handling-sequence" />
    </faultSequence>
  </resource>

  <resource methods="PUT" uri-template="/periodos-amortizacion/{id}">
    <inSequence>
      <call-template target="sgi-auth-sequence-template">
        <with-param name="requiredAuthorities" value="" />
      </call-template>
      <sequence key="sge-add-x-api-key-sequence" />
      <sequence key="sge-remove-authorization-header-sequence" />
      <send>
        <endpoint key="sge-endpoint" />
      </send>
    </inSequence>
    <outSequence>
      <respond />
    </outSequence>
    <faultSequence>
      <sequence key="error-handling-sequence" />
    </faultSequence>
  </resource>

  <resource methods="DELETE" uri-template="/periodos-amortizacion/{id}">
    <inSequence>
      <call-template target="sgi-auth-sequence-template">
        <with-param name="requiredAuthorities" value="" />
      </call-template>
      <sequence key="sge-add-x-api-key-sequence" />
      <sequence key="sge-remove-authorization-header-sequence" />
      <send>
        <endpoint key="sge-endpoint" />
      </send>
    </inSequence>
    <outSequence>
      <respond />
    </outSequence>
    <faultSequence>
      <sequence key="error-handling-sequence" />
    </faultSequence>
  </resource>

  <!-- Seguimiento justifiaccion -->
  <resource methods="GET" url-mapping="/seguimiento-justificacion">
    <inSequence>
      <call-template target="sgi-auth-sequence-template">
        <with-param name="requiredAuthorities" value="" />
      </call-template>
      <sequence key="sge-add-x-api-key-sequence" />
      <sequence key="sge-remove-authorization-header-sequence" />
      <send>
        <endpoint key="sge-endpoint" />
      </send>
    </inSequence>
    <outSequence>
      <respond />
    </outSequence>
    <faultSequence>
      <sequence key="error-handling-sequence" />
    </faultSequence>
  </resource>

  <resource methods="GET" url-mapping="/seguimiento-justificacion/columnas">
    <inSequence>
      <call-template target="sgi-auth-sequence-template">
        <with-param name="requiredAuthorities" value="" />
      </call-template>
      <sequence key="sge-add-x-api-key-sequence" />
      <sequence key="sge-remove-authorization-header-sequence" />
      <send>
        <endpoint key="sge-endpoint" />
      </send>
    </inSequence>
    <outSequence>
      <respond />
    </outSequence>
    <faultSequence>
      <sequence key="error-handling-sequence" />
    </faultSequence>
  </resource>

  <resource methods="GET" uri-template="/seguimiento-justificacion/{id}">
    <inSequence>
      <call-template target="sgi-auth-sequence-template">
        <with-param name="requiredAuthorities" value="" />
      </call-template>
      <sequence key="sge-add-x-api-key-sequence" />
      <sequence key="sge-remove-authorization-header-sequence" />
      <send>
        <endpoint key="sge-endpoint" />
      </send>
    </inSequence>
    <outSequence>
      <respond />
    </outSequence>
    <faultSequence>
      <sequence key="error-handling-sequence" />
    </faultSequence>
  </resource>
  
</api>